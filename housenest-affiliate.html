<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HouseNest ‚Äî Affiliate & Referral Programme</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,700;0,800;1,700&family=DM+Sans:wght@300;400;500;600;700&family=IBM+Plex+Mono:wght@400;700&display=swap" rel="stylesheet">
<style>
:root{
  --night:   #080e09;
  --deep:    #0f1e11;
  --forest:  #1a3a1e;
  --moss:    #2c5e32;
  --sage:    #4a8c52;
  --mint:    #72c47c;
  --lime:    #a8e0b0;
  --ivory:   #f4eed8;
  --cream:   #ebe4cc;
  --sand:    #ddd4b8;
  --mist:    #eeead8;
  --white:   #faf7ee;
  --flame:   #d44e1a;
  --ember:   #b83d10;
  --gold:    #d4962a;
  --amber:   #b87820;
  --smoke:   #7a776e;
  --ash:     #bab8b0;
  --err:     #c83030;
  --ok:      #2a8040;
  /* tier colours */
  --t-corper: #d44e1a;
  --t-influencer: #9c3adc;
  --t-user: #2c5e32;
  --t-agent: #1a4a8c;
}
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
html{scroll-behavior:smooth;font-size:16px}
body{font-family:'DM Sans',sans-serif;background:var(--white);color:var(--night);overflow-x:hidden}
button{font-family:inherit;cursor:pointer}
input,select,textarea{font-family:inherit}
a{color:inherit;text-decoration:none}

/* SCROLLBAR */
::-webkit-scrollbar{width:6px}
::-webkit-scrollbar-track{background:var(--mist)}
::-webkit-scrollbar-thumb{background:var(--moss);border-radius:3px}

/* NAV */
#nav{position:fixed;top:0;left:0;right:0;z-index:900;height:62px;display:flex;align-items:center;background:rgba(250,247,238,0.96);backdrop-filter:blur(20px);border-bottom:1px solid rgba(26,58,30,0.08)}
.nav-inner{width:100%;max-width:1280px;margin:0 auto;padding:0 2rem;display:flex;align-items:center;justify-content:space-between;gap:1rem}
.nav-logo{display:flex;align-items:center;gap:0.5rem;cursor:pointer}
.nav-logo-mark{width:32px;height:32px;background:var(--forest);border-radius:8px;display:flex;align-items:center;justify-content:center;font-family:'Playfair Display',serif;font-size:0.9rem;font-weight:700;color:var(--ivory)}
.nav-logo-text{font-family:'Playfair Display',serif;font-size:1.25rem;font-weight:700;color:var(--forest)}
.nav-logo-text span{color:var(--flame)}
.nav-pill{background:linear-gradient(135deg,var(--flame),var(--amber));color:white;padding:0.28rem 0.8rem;border-radius:50px;font-size:0.72rem;font-weight:700;letter-spacing:0.02em}
.nav-tabs{display:flex;gap:0.25rem}
.ntab{padding:0.38rem 0.85rem;border-radius:8px;border:none;background:none;font-size:0.8rem;font-weight:600;color:var(--smoke);cursor:pointer;transition:all 0.2s;white-space:nowrap}
.ntab:hover{background:var(--mist);color:var(--forest)}
.ntab.active{background:var(--forest);color:var(--ivory)}
.nav-right{display:flex;gap:0.5rem;align-items:center;flex-shrink:0}
.nav-btn{border:none;padding:0.45rem 1rem;border-radius:8px;font-size:0.82rem;font-weight:700;cursor:pointer;transition:all 0.2s}
.nav-btn-ghost{background:none;border:1.5px solid rgba(26,58,30,0.2);color:var(--forest)}
.nav-btn-ghost:hover{border-color:var(--flame);color:var(--flame)}
.nav-btn-solid{background:var(--forest);color:var(--ivory)}
.nav-btn-solid:hover{background:var(--flame)}
#userNav{display:none;align-items:center;gap:0.7rem}
.user-av{width:34px;height:34px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:0.82rem;color:white;cursor:pointer;transition:transform 0.2s}
.user-av:hover{transform:scale(1.08)}

/* PAGE & VIEWS */
.page{padding-top:62px;min-height:100vh}
.view{display:none;animation:fadeUp 0.35s ease both}
.view.active{display:block}

/* HERO */
.hero{background:var(--deep);min-height:calc(100vh - 62px);display:flex;flex-direction:column;justify-content:center;padding:4rem 2rem 3rem;position:relative;overflow:hidden}
.hero-mesh{position:absolute;inset:0;background:radial-gradient(ellipse 80% 60% at 70% 40%,rgba(44,94,50,0.25) 0%,transparent 70%),radial-gradient(ellipse 60% 50% at 20% 70%,rgba(212,150,42,0.1) 0%,transparent 60%);pointer-events:none}
.hero-grid-bg{position:absolute;inset:0;background-image:linear-gradient(rgba(114,196,124,0.04) 1px,transparent 1px),linear-gradient(90deg,rgba(114,196,124,0.04) 1px,transparent 1px);background-size:40px 40px;pointer-events:none}
.hero-inner{max-width:1280px;margin:0 auto;width:100%;display:grid;grid-template-columns:1fr 1fr;gap:4rem;align-items:center;position:relative;z-index:1}
.hero-eyebrow{display:inline-flex;align-items:center;gap:0.6rem;margin-bottom:1.4rem}
.eyebrow-dot{width:7px;height:7px;border-radius:50%;background:var(--mint);animation:pulseDot 2s infinite}
.eyebrow-text{font-family:'IBM Plex Mono',monospace;font-size:0.62rem;color:var(--mint);text-transform:uppercase;letter-spacing:0.18em}
.hero-h1{font-family:'Playfair Display',serif;font-size:clamp(2.6rem,5vw,4.5rem);font-weight:800;color:var(--ivory);line-height:0.95;margin-bottom:1.4rem}
.hero-h1 em{font-style:italic;color:var(--mint);display:block}
.hero-h1 .flame-word{color:var(--flame)}
.hero-sub{font-size:1rem;color:rgba(244,238,216,0.58);line-height:1.75;font-weight:300;max-width:500px;margin-bottom:2.2rem}
.hero-ctas{display:flex;gap:0.8rem;flex-wrap:wrap}
.btn-hero-primary{background:var(--flame);color:white;border:none;padding:0.85rem 2rem;border-radius:12px;font-size:0.95rem;font-weight:700;cursor:pointer;transition:all 0.25s;display:inline-flex;align-items:center;gap:0.5rem}
.btn-hero-primary:hover{background:#c04010;transform:translateY(-2px);box-shadow:0 8px 24px rgba(212,78,26,0.35)}
.btn-hero-secondary{background:rgba(244,238,216,0.08);border:1.5px solid rgba(244,238,216,0.2);color:rgba(244,238,216,0.8);padding:0.85rem 1.8rem;border-radius:12px;font-size:0.95rem;font-weight:600;cursor:pointer;transition:all 0.25s}
.btn-hero-secondary:hover{background:rgba(244,238,216,0.14);border-color:rgba(244,238,216,0.4);color:var(--ivory)}
/* Tier preview cards on hero */
.hero-right{display:flex;flex-direction:column;gap:0.8rem}
.tier-preview-card{border-radius:16px;padding:1.2rem 1.4rem;border:1px solid rgba(244,238,216,0.1);background:rgba(244,238,216,0.05);backdrop-filter:blur(8px);cursor:pointer;transition:all 0.3s;position:relative;overflow:hidden}
.tier-preview-card::before{content:'';position:absolute;inset:0;opacity:0;transition:opacity 0.3s}
.tier-preview-card:hover{transform:translateX(6px);border-color:rgba(244,238,216,0.2)}
.tpc-tag{font-family:'IBM Plex Mono',monospace;font-size:0.6rem;text-transform:uppercase;letter-spacing:0.12em;margin-bottom:0.5rem;display:flex;align-items:center;gap:0.5rem}
.tpc-name{font-family:'Playfair Display',serif;font-size:1.1rem;font-weight:700;color:var(--ivory);margin-bottom:0.25rem}
.tpc-commission{font-family:'IBM Plex Mono',monospace;font-size:1.5rem;font-weight:700}
.tpc-desc{font-size:0.75rem;color:rgba(244,238,216,0.42);margin-top:0.3rem}

/* SECTION */
.section{padding:5rem 0}
.section-alt{background:var(--mist)}
.section-dark{background:var(--deep)}
.container{max-width:1280px;margin:0 auto;padding:0 2rem}
.eyebrow{display:flex;align-items:center;gap:0.7rem;margin-bottom:0.75rem}
.eyebrow-line{width:20px;height:1.5px;background:var(--flame)}
.eyebrow-label{font-family:'IBM Plex Mono',monospace;font-size:0.62rem;color:var(--flame);text-transform:uppercase;letter-spacing:0.15em}
.section-h2{font-family:'Playfair Display',serif;font-size:clamp(1.9rem,3.5vw,2.9rem);font-weight:700;color:var(--forest);line-height:1.05;margin-bottom:0.6rem}
.section-h2 em{font-style:italic;color:var(--flame)}
.section-h2-light{color:var(--ivory)}
.section-sub{font-size:0.92rem;color:var(--smoke);line-height:1.75;max-width:540px;font-weight:400;margin-top:0.5rem}
.section-sub-light{color:rgba(244,238,216,0.5)}

/* TIER CARDS */
.tiers-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:1.2rem;margin-top:3rem}
.tier-card{border-radius:20px;overflow:hidden;border:1.5px solid var(--sand);background:white;transition:all 0.3s;cursor:pointer;position:relative}
.tier-card:hover{transform:translateY(-6px);box-shadow:0 20px 50px rgba(8,14,9,0.12);border-color:transparent}
.tier-card.featured{border-color:var(--flame);box-shadow:0 0 0 3px rgba(212,78,26,0.1)}
.tc-header{padding:1.6rem 1.5rem 1.2rem}
.tc-icon{width:48px;height:48px;border-radius:14px;display:flex;align-items:center;justify-content:center;font-size:1.5rem;margin-bottom:1rem}
.tc-tag{font-family:'IBM Plex Mono',monospace;font-size:0.58rem;text-transform:uppercase;letter-spacing:0.12em;margin-bottom:0.5rem}
.tc-name{font-family:'Playfair Display',serif;font-size:1.25rem;font-weight:700;color:var(--night);margin-bottom:0.3rem}
.tc-commission-label{font-size:0.7rem;color:var(--smoke);margin-bottom:0.2rem}
.tc-commission{font-family:'IBM Plex Mono',monospace;font-size:2rem;font-weight:700;line-height:1}
.tc-per{font-size:0.72rem;color:var(--smoke);font-family:'DM Sans',sans-serif;margin-top:0.2rem}
.tc-divider{border:none;border-top:1px solid var(--mist);margin:0}
.tc-body{padding:1.2rem 1.5rem}
.tc-perks{display:flex;flex-direction:column;gap:0.4rem;margin-bottom:1.2rem}
.tc-perk{display:flex;align-items:flex-start;gap:0.5rem;font-size:0.78rem;color:var(--forest)}
.tc-perk-icon{flex-shrink:0;font-size:0.85rem;margin-top:1px}
.featured-ribbon{position:absolute;top:1rem;right:-0.5rem;background:var(--flame);color:white;font-size:0.62rem;font-weight:700;padding:0.2rem 1rem;border-radius:50px}

/* HOW IT WORKS */
.how-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:1.5rem;margin-top:3rem}
.how-card{background:white;border-radius:18px;padding:2rem;border:1px solid var(--sand);transition:all 0.3s;position:relative;overflow:hidden}
.how-card:hover{box-shadow:0 12px 32px rgba(8,14,9,0.09);transform:translateY(-3px);border-color:transparent}
.how-card::before{content:attr(data-num);position:absolute;top:-0.5rem;right:1rem;font-family:'Playfair Display',serif;font-size:6rem;font-weight:800;color:rgba(26,58,30,0.05);line-height:1;pointer-events:none}
.how-icon{font-size:2rem;margin-bottom:1rem}
.how-title{font-weight:700;font-size:1rem;color:var(--forest);margin-bottom:0.4rem}
.how-desc{font-size:0.82rem;color:var(--smoke);line-height:1.7}

/* DASHBOARD LAYOUT */
.dash-layout{display:grid;grid-template-columns:250px 1fr;min-height:calc(100vh - 62px)}
.dash-sidebar{background:var(--deep);padding:1.8rem 1rem;display:flex;flex-direction:column;gap:0.25rem;position:sticky;top:62px;height:calc(100vh - 62px);overflow-y:auto}
.ds-user-block{display:flex;align-items:center;gap:0.7rem;padding:0.8rem;border-radius:12px;background:rgba(244,238,216,0.06);margin-bottom:1rem}
.ds-user-av{width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:1rem;color:white;flex-shrink:0}
.ds-user-name{font-weight:700;font-size:0.85rem;color:var(--ivory)}
.ds-user-tier{font-size:0.68rem;color:rgba(244,238,216,0.4);margin-top:0.1rem;text-transform:capitalize}
.ds-tier-badge{display:inline-flex;align-items:center;gap:0.3rem;padding:0.18rem 0.55rem;border-radius:50px;font-size:0.62rem;font-weight:700;margin-top:0.3rem}
.ds-label{font-family:'IBM Plex Mono',monospace;font-size:0.56rem;color:rgba(244,238,216,0.25);text-transform:uppercase;letter-spacing:0.12em;padding:0.5rem 0.7rem 0.2rem;margin-top:0.5rem}
.ds-btn{display:flex;align-items:center;gap:0.65rem;padding:0.6rem 0.85rem;border-radius:10px;border:none;background:none;color:rgba(244,238,216,0.55);font-size:0.84rem;font-weight:500;cursor:pointer;width:100%;text-align:left;transition:all 0.2s}
.ds-btn:hover{background:rgba(244,238,216,0.07);color:var(--ivory)}
.ds-btn.active{background:rgba(244,238,216,0.11);color:var(--ivory);font-weight:700}
.ds-btn .ds-icon{font-size:1rem;flex-shrink:0}
.ds-btn .ds-badge{background:var(--flame);color:white;border-radius:50px;font-size:0.6rem;font-weight:700;padding:0.1rem 0.45rem;margin-left:auto}
.dash-main{background:var(--mist);padding:2rem;overflow-y:auto}

/* DASHBOARD PANELS */
.dp-title{font-family:'Playfair Display',serif;font-size:1.7rem;font-weight:700;color:var(--forest);margin-bottom:0.25rem}
.dp-sub{font-size:0.82rem;color:var(--smoke);margin-bottom:2rem}
.stats-row{display:grid;grid-template-columns:repeat(4,1fr);gap:1rem;margin-bottom:2rem}
.stat-card{background:white;border-radius:14px;padding:1.2rem;border:1px solid var(--sand)}
.stat-n{font-family:'Playfair Display',serif;font-size:2rem;font-weight:700;color:var(--forest);line-height:1}
.stat-l{font-size:0.72rem;color:var(--smoke);margin-top:0.2rem}
.stat-delta{font-size:0.7rem;font-weight:700;margin-top:0.3rem}
.stat-up{color:var(--ok)}
.stat-down{color:var(--err)}
.dash-panel{background:white;border-radius:16px;border:1px solid var(--sand);margin-bottom:1.5rem;overflow:hidden}
.dash-panel-header{padding:1.3rem 1.6rem;border-bottom:1px solid var(--mist);display:flex;justify-content:space-between;align-items:center}
.dph-title{font-weight:700;color:var(--forest);font-size:0.95rem}
.dash-panel-body{padding:1.5rem 1.6rem}

/* REFERRAL CODE CARD */
.code-card{background:linear-gradient(135deg,var(--forest),var(--deep));border-radius:18px;padding:1.8rem;position:relative;overflow:hidden;margin-bottom:1.5rem}
.code-card::before{content:'';position:absolute;inset:0;background-image:radial-gradient(circle,rgba(114,196,124,0.08) 1px,transparent 1px);background-size:20px 20px}
.code-card-label{font-family:'IBM Plex Mono',monospace;font-size:0.6rem;color:rgba(244,238,216,0.4);text-transform:uppercase;letter-spacing:0.15em;margin-bottom:0.6rem;position:relative;z-index:1}
.code-display{font-family:'IBM Plex Mono',monospace;font-size:1.8rem;font-weight:700;color:var(--ivory);letter-spacing:0.12em;margin-bottom:0.5rem;position:relative;z-index:1;display:flex;align-items:center;gap:1rem;flex-wrap:wrap}
.code-copy-btn{background:rgba(244,238,216,0.1);border:1px solid rgba(244,238,216,0.2);color:rgba(244,238,216,0.7);border-radius:8px;padding:0.35rem 0.8rem;font-size:0.75rem;font-weight:700;cursor:pointer;transition:all 0.2s;position:relative;z-index:1}
.code-copy-btn:hover{background:rgba(244,238,216,0.2);color:var(--ivory)}
.code-link{font-size:0.78rem;color:rgba(244,238,216,0.45);font-family:'IBM Plex Mono',monospace;position:relative;z-index:1;word-break:break-all;margin-bottom:1rem}
.code-share-row{display:flex;gap:0.5rem;flex-wrap:wrap;position:relative;z-index:1}
.share-btn{display:flex;align-items:center;gap:0.4rem;padding:0.45rem 0.9rem;border-radius:8px;font-size:0.75rem;font-weight:700;border:none;cursor:pointer;transition:all 0.2s}
.share-twitter{background:#1da1f2;color:white}
.share-whatsapp{background:#25d366;color:white}
.share-instagram{background:linear-gradient(135deg,#f09433,#e6683c,#dc2743,#cc2366,#bc1888);color:white}
.share-facebook{background:#1877f2;color:white}
.share-copy{background:rgba(244,238,216,0.1);border:1px solid rgba(244,238,216,0.2);color:rgba(244,238,216,0.8)}
.share-btn:hover{transform:translateY(-1px);filter:brightness(1.1)}

/* COMMISSION TABLE */
.comm-table{width:100%;border-collapse:collapse}
.comm-table th{font-family:'IBM Plex Mono',monospace;font-size:0.62rem;text-transform:uppercase;letter-spacing:0.08em;color:var(--smoke);padding:0.6rem 0.8rem;border-bottom:2px solid var(--mist);text-align:left;white-space:nowrap}
.comm-table td{padding:0.85rem 0.8rem;border-bottom:1px solid var(--mist);font-size:0.83rem;color:var(--night)}
.comm-table tr:last-child td{border-bottom:none}
.comm-table tr:hover td{background:rgba(26,58,30,0.03)}
.comm-amount{font-family:'IBM Plex Mono',monospace;font-weight:700;color:var(--forest)}
.comm-pending{color:var(--amber);font-weight:700;font-size:0.72rem}
.comm-paid{color:var(--ok);font-weight:700;font-size:0.72rem}
.comm-processing{color:var(--smoke);font-weight:700;font-size:0.72rem}

/* LEADERBOARD */
.lb-row{display:flex;align-items:center;gap:1rem;padding:0.9rem;border-radius:12px;transition:all 0.2s;margin-bottom:0.4rem}
.lb-row:hover{background:var(--mist)}
.lb-rank{font-family:'IBM Plex Mono',monospace;font-size:0.85rem;font-weight:700;width:28px;text-align:center;flex-shrink:0}
.lb-rank-1{color:var(--gold)}
.lb-rank-2{color:var(--ash)}
.lb-rank-3{color:var(--amber)}
.lb-av{width:38px;height:38px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:0.9rem;color:white;flex-shrink:0}
.lb-name{font-weight:700;font-size:0.88rem;color:var(--night)}
.lb-meta{font-size:0.72rem;color:var(--smoke)}
.lb-earnings{font-family:'IBM Plex Mono',monospace;font-weight:700;color:var(--forest);margin-left:auto;font-size:0.9rem}
.lb-refs{font-size:0.7rem;color:var(--smoke);text-align:right}

/* WITHDRAW FORM */
.withdraw-card{background:white;border-radius:16px;border:1px solid var(--sand);padding:1.6rem;margin-bottom:1.5rem}
.balance-display{background:linear-gradient(135deg,var(--forest),var(--moss));border-radius:14px;padding:1.4rem;margin-bottom:1.2rem;position:relative;overflow:hidden}
.balance-display::before{content:'';position:absolute;right:-20px;top:-20px;width:120px;height:120px;border-radius:50%;background:rgba(114,196,124,0.1)}
.bal-label{font-size:0.72rem;color:rgba(244,238,216,0.5);margin-bottom:0.4rem}
.bal-amount{font-family:'Playfair Display',serif;font-size:2.5rem;font-weight:700;color:var(--ivory);line-height:1}
.bal-pending{font-size:0.78rem;color:rgba(244,238,216,0.45);margin-top:0.3rem}

/* ADMIN PANEL */
.admin-stats{display:grid;grid-template-columns:repeat(4,1fr);gap:1rem;margin-bottom:1.5rem}
.ast{background:white;border-radius:12px;padding:1.1rem;border:1px solid var(--sand)}
.ast-n{font-family:'Playfair Display',serif;font-size:1.7rem;font-weight:700;color:var(--forest);line-height:1}
.ast-l{font-size:0.7rem;color:var(--smoke);margin-top:0.15rem}
.aff-row{display:flex;align-items:center;gap:0.8rem;padding:0.9rem;border:1px solid var(--sand);border-radius:12px;margin-bottom:0.6rem;transition:all 0.2s;background:white}
.aff-row:hover{border-color:var(--sage);box-shadow:0 3px 12px rgba(8,14,9,0.06)}
.aff-av{width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700;color:white;font-size:0.95rem;flex-shrink:0}
.aff-name{font-weight:700;font-size:0.88rem;color:var(--night)}
.aff-meta{font-size:0.72rem;color:var(--smoke);margin-top:0.15rem}
.aff-code{font-family:'IBM Plex Mono',monospace;font-size:0.75rem;color:var(--moss);background:rgba(44,94,50,0.1);padding:0.15rem 0.55rem;border-radius:5px}
.aff-earnings{margin-left:auto;text-align:right;flex-shrink:0}
.aff-earn-n{font-family:'IBM Plex Mono',monospace;font-weight:700;font-size:0.88rem;color:var(--forest)}
.aff-earn-l{font-size:0.68rem;color:var(--smoke)}
.aff-tier-tag{padding:0.18rem 0.55rem;border-radius:50px;font-size:0.62rem;font-weight:700;margin-left:0.5rem}
.att-corper{background:rgba(212,78,26,0.12);color:var(--t-corper)}
.att-influencer{background:rgba(156,58,220,0.12);color:var(--t-influencer)}
.att-user{background:rgba(44,94,50,0.12);color:var(--t-user)}
.att-agent{background:rgba(26,74,140,0.12);color:var(--t-agent)}
.approve-btn{background:rgba(42,128,64,0.1);color:var(--ok);border:1px solid rgba(42,128,64,0.2);border-radius:8px;padding:0.35rem 0.75rem;font-size:0.72rem;font-weight:700;cursor:pointer;transition:all 0.2s;white-space:nowrap}
.approve-btn:hover{background:var(--ok);color:white}
.reject-btn{background:rgba(200,48,48,0.08);color:var(--err);border:1px solid rgba(200,48,48,0.15);border-radius:8px;padding:0.35rem 0.75rem;font-size:0.72rem;font-weight:700;cursor:pointer;transition:all 0.2s;margin-left:0.35rem;white-space:nowrap}
.reject-btn:hover{background:var(--err);color:white}

/* FORMS */
.f-group{margin-bottom:1.1rem}
.f-label{display:block;font-size:0.72rem;font-weight:700;text-transform:uppercase;letter-spacing:0.06em;color:var(--forest);margin-bottom:0.42rem}
.f-input,.f-select,.f-textarea{width:100%;padding:0.72rem 1rem;border:1.5px solid var(--sand);border-radius:10px;font-family:'DM Sans';font-size:0.88rem;color:var(--night);background:white;outline:none;transition:border-color 0.2s,box-shadow 0.2s}
.f-input:focus,.f-select:focus,.f-textarea:focus{border-color:var(--moss);box-shadow:0 0 0 3px rgba(44,94,50,0.1)}
.f-row{display:grid;grid-template-columns:1fr 1fr;gap:0.8rem}
.f-hint{font-size:0.72rem;color:var(--smoke);margin-top:0.3rem}
.f-err{font-size:0.72rem;color:var(--err);margin-top:0.3rem;display:none}
.f-err.show{display:block}

/* MODAL */
.modal-bg{position:fixed;inset:0;z-index:1000;background:rgba(8,14,9,0.82);backdrop-filter:blur(8px);display:none;align-items:center;justify-content:center;padding:1.5rem}
.modal-bg.open{display:flex}
.modal{background:var(--white);border-radius:20px;padding:2rem;max-width:480px;width:100%;max-height:88vh;overflow-y:auto;animation:popIn 0.28s ease;box-shadow:0 28px 70px rgba(0,0,0,0.35)}
.modal-h{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:1.4rem}
.modal-title{font-family:'Playfair Display',serif;font-size:1.45rem;font-weight:700;color:var(--forest)}
.modal-close{background:var(--mist);border:none;width:28px;height:28px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:0.9rem;color:var(--smoke);cursor:pointer;transition:all 0.2s;flex-shrink:0}
.modal-close:hover{background:var(--err);color:white}
.modal-tabs{display:flex;gap:0;border:1.5px solid var(--sand);border-radius:10px;padding:3px;margin-bottom:1.3rem}
.mtab{flex:1;padding:0.48rem;border-radius:8px;border:none;font-family:'DM Sans';font-size:0.82rem;font-weight:600;cursor:pointer;background:transparent;color:var(--smoke);transition:all 0.2s}
.mtab.active{background:var(--forest);color:white}
.role-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:0.5rem;margin-bottom:1.1rem}
.role-card{border:1.5px solid var(--sand);border-radius:12px;padding:0.9rem 0.7rem;text-align:center;cursor:pointer;transition:all 0.2s;background:white}
.role-card:hover{border-color:var(--moss)}
.role-card.active{border-color:var(--forest);background:var(--forest)}
.role-card.active .rc-name{color:white}
.role-card.active .rc-icon{filter:none}
.rc-icon{font-size:1.5rem;margin-bottom:0.3rem}
.rc-name{font-size:0.78rem;font-weight:700;color:var(--forest)}
.rc-comm{font-family:'IBM Plex Mono',monospace;font-size:0.72rem;color:var(--flame);margin-top:0.15rem}

/* BUTTONS */
.btn{display:inline-flex;align-items:center;gap:0.5rem;padding:0.68rem 1.4rem;border-radius:10px;border:none;font-size:0.86rem;font-weight:700;cursor:pointer;transition:all 0.22s}
.btn-primary{background:var(--forest);color:var(--ivory)}
.btn-primary:hover{background:var(--flame);transform:translateY(-1px)}
.btn-flame{background:var(--flame);color:white}
.btn-flame:hover{background:var(--ember)}
.btn-outline{background:transparent;border:1.5px solid var(--forest);color:var(--forest)}
.btn-outline:hover{background:var(--forest);color:var(--ivory)}
.btn-ghost{background:transparent;color:var(--smoke);padding:0.5rem;border:none}
.btn-ghost:hover{color:var(--forest)}
.btn-sm{padding:0.4rem 0.85rem;font-size:0.77rem;border-radius:8px}
.btn-full{width:100%;justify-content:center}
.btn-ok{background:var(--ok);color:white}
.btn-ok:hover{background:#1e6030}

/* TOAST */
.toast-c{position:fixed;bottom:1.5rem;right:1.5rem;z-index:9999;display:flex;flex-direction:column;gap:0.5rem;pointer-events:none}
.toast{background:var(--night);color:white;padding:0.78rem 1.2rem;border-radius:12px;font-size:0.82rem;font-weight:500;box-shadow:0 8px 24px rgba(0,0,0,0.3);display:flex;align-items:center;gap:0.6rem;max-width:300px;animation:toastIn 0.3s ease;pointer-events:all}
.toast.ok{background:var(--moss)}
.toast.warn{background:var(--amber)}
.toast.err{background:var(--err)}

/* ANIMATIONS */
@keyframes fadeUp{from{opacity:0;transform:translateY(14px)}to{opacity:1;transform:translateY(0)}}
@keyframes popIn{from{opacity:0;transform:scale(0.94)}to{opacity:1;transform:scale(1)}}
@keyframes toastIn{from{opacity:0;transform:translateX(16px)}to{opacity:1;transform:translateX(0)}}
@keyframes pulseDot{0%,100%{opacity:1}50%{opacity:0.3}}
@keyframes ticker{from{transform:translateX(0)}to{transform:translateX(-50%)}}
@keyframes spin{to{transform:rotate(360deg)}}

/* MISC */
.hidden{display:none!important}
.divider{border:none;border-top:1px solid var(--sand);margin:1.2rem 0}
.tag{display:inline-flex;align-items:center;gap:0.3rem;padding:0.22rem 0.65rem;border-radius:50px;font-size:0.68rem;font-weight:700}
.chip-row{display:flex;gap:0.4rem;flex-wrap:wrap;margin-bottom:0.8rem}

/* RESPONSIVE */
@media(max-width:1024px){
  .tiers-grid{grid-template-columns:repeat(2,1fr)}
  .hero-inner{grid-template-columns:1fr}
  .hero-right{display:none}
  .dash-layout{grid-template-columns:1fr}
  .dash-sidebar{height:auto;position:static;flex-direction:row;flex-wrap:wrap;padding:1rem;gap:0.3rem}
  .ds-label{display:none}
  .ds-user-block{display:none}
  .stats-row{grid-template-columns:repeat(2,1fr)}
  .admin-stats{grid-template-columns:repeat(2,1fr)}
}
@media(max-width:768px){
  .container{padding:0 1.2rem}
  .tiers-grid{grid-template-columns:1fr}
  .how-grid{grid-template-columns:1fr}
  .f-row{grid-template-columns:1fr}
  .stats-row{grid-template-columns:1fr 1fr}
  .role-grid{grid-template-columns:repeat(2,1fr)}
  .ntab span{display:none}
  .hero-h1{font-size:2.4rem}
}
</style>
</head>
<body>

<!-- NAV -->
<nav id="nav">
  <div class="nav-inner">
    <div class="nav-logo" onclick="goHome()">
      <div class="nav-logo-mark">HN</div>
      <div class="nav-logo-text">House<span>Nest</span></div>
    </div>
    <div class="nav-tabs">
      <button class="ntab active" onclick="showView('home',this)"><span>üè†</span> Programme</button>
      <button class="ntab" onclick="showView('join',this)"><span>‚ú¶</span> Join Now</button>
      <button class="ntab" onclick="requireAuth(()=>showView('dashboard',this))"><span>üìä</span> Dashboard</button>
      <button class="ntab" onclick="requireAuth(()=>showView('admin-view',this),true)"><span>‚öôÔ∏è</span> Admin</button>
    </div>
    <div class="nav-right">
      <div id="guestNav" style="display:flex;gap:0.5rem">
        <button class="nav-btn nav-btn-ghost" onclick="openModal('authModal','login')">Log In</button>
        <button class="nav-btn nav-btn-solid" onclick="openModal('authModal','signup')">Join Programme</button>
      </div>
      <div id="userNav">
        <span id="userAv" class="user-av" onclick="showView('dashboard',null)" title="My Dashboard"></span>
        <button class="nav-btn nav-btn-ghost" onclick="logout()">Log Out</button>
      </div>
    </div>
  </div>
</nav>

<div class="page">

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê HOME / PROGRAMME INFO ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="view active" id="view-home">

  <!-- Hero -->
  <section class="hero">
    <div class="hero-mesh"></div>
    <div class="hero-grid-bg"></div>
    <div class="hero-inner container">
      <div>
        <div class="hero-eyebrow"><span class="eyebrow-dot"></span><span class="eyebrow-text">HouseNest Affiliate Programme ¬∑ Southwest Nigeria</span></div>
        <h1 class="hero-h1">Earn real money<br><em>every time</em> someone<br><span class="flame-word">finds a home.</span></h1>
        <p class="hero-sub">Share your unique referral code. When a tenant signs a lease or a landlord lists a property through your link, you earn commission ‚Äî automatically, instantly tracked, paid to your bank account.</p>
        <div class="hero-ctas">
          <button class="btn-hero-primary" onclick="openModal('authModal','signup')">Get My Referral Code ‚Üí</button>
          <button class="btn-hero-secondary" onclick="document.getElementById('tiers-section').scrollIntoView({behavior:'smooth'})">See Commission Rates</button>
        </div>
      </div>
      <div class="hero-right" id="heroPreviews"></div>
    </div>
  </section>

  <!-- Tiers -->
  <section class="section container" id="tiers-section">
    <div class="eyebrow"><div class="eyebrow-line"></div><span class="eyebrow-label">Commission Tiers</span></div>
    <h2 class="section-h2">Four tiers. <em>One programme.</em></h2>
    <p class="section-sub">Your tier determines your commission rate and the tools available to you. NYSC corpers earn the highest rate ‚Äî because they're on the ground, in the camps, talking to hundreds of prospective tenants every day.</p>
    <div class="tiers-grid" id="tiersGrid"></div>
  </section>

  <!-- How it works -->
  <section class="section section-alt container">
    <div class="eyebrow"><div class="eyebrow-line"></div><span class="eyebrow-label">How It Works</span></div>
    <h2 class="section-h2">Three steps to <em>earning.</em></h2>
    <div class="how-grid">
      <div class="how-card" data-num="01">
        <div class="how-icon">ü™™</div>
        <div class="how-title">Sign Up & Choose Your Tier</div>
        <div class="how-desc">Create your HouseNest affiliate account. Select your role ‚Äî NYSC Corper, Social Media Influencer, Registered Agent, or General User. Your tier is verified and your unique code is generated instantly.</div>
      </div>
      <div class="how-card" data-num="02">
        <div class="how-icon">üì§</div>
        <div class="how-title">Share Your Code Everywhere</div>
        <div class="how-desc">Drop your unique link on Twitter, WhatsApp, Instagram Stories, Facebook groups, TikTok ‚Äî or hand your code to a corper at camp orientation. Every method is tracked. Every referral counts.</div>
      </div>
      <div class="how-card" data-num="03">
        <div class="how-icon">üí∏</div>
        <div class="how-title">Get Paid to Your Bank Account</div>
        <div class="how-desc">Commissions accrue in real time. Withdraw any time you reach ‚Ç¶2,000 minimum. Paid via Paystack to any Nigerian bank account within 24 hours of withdrawal request.</div>
      </div>
    </div>
  </section>

  <!-- What earns commission -->
  <section class="section section-dark">
    <div class="container">
      <div class="eyebrow"><div class="eyebrow-line" style="background:var(--mint)"></div><span class="eyebrow-label" style="color:var(--mint)">What Earns You Money</span></div>
      <h2 class="section-h2 section-h2-light">Every referral that converts <em style="color:var(--mint)">pays you.</em></h2>
      <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:1.2rem;margin-top:2.5rem" id="earnsGrid"></div>
    </div>
  </section>

  <!-- Influencer CTA -->
  <section class="section container">
    <div style="background:linear-gradient(135deg,#1a3a1e,#080e09);border-radius:24px;padding:3rem;display:grid;grid-template-columns:1fr 1fr;gap:3rem;align-items:center;position:relative;overflow:hidden">
      <div style="position:absolute;right:-40px;bottom:-40px;width:200px;height:200px;border-radius:50%;background:rgba(212,78,26,0.08)"></div>
      <div>
        <div style="font-family:'IBM Plex Mono',monospace;font-size:0.62rem;color:var(--mint);text-transform:uppercase;letter-spacing:0.15em;margin-bottom:0.8rem">For Influencers with 5,000+ Followers</div>
        <h3 style="font-family:'Playfair Display',serif;font-size:2rem;font-weight:700;color:var(--ivory);line-height:1.1;margin-bottom:0.8rem">Big audience?<br><em style="color:var(--flame)">Big commissions.</em></h3>
        <p style="font-size:0.85rem;color:rgba(244,238,216,0.5);line-height:1.7">If you have an engaged audience on Twitter/X, Instagram, TikTok, or Facebook ‚Äî HouseNest is one of the most natural sponsorships you can run. Your audience is moving, relocating, starting fresh. Help them find a home.</p>
      </div>
      <div style="background:rgba(244,238,216,0.05);border:1px solid rgba(244,238,216,0.1);border-radius:16px;padding:1.6rem">
        <div style="font-size:0.72rem;color:rgba(244,238,216,0.35);text-transform:uppercase;letter-spacing:0.08em;margin-bottom:1rem;font-family:'IBM Plex Mono',monospace">Sample Earnings ‚Äî Influencer Tier</div>
        <div id="earningsCalc"></div>
        <button class="btn btn-flame btn-full" style="margin-top:1.2rem;font-size:0.9rem" onclick="openModal('authModal','signup')">Apply as Influencer ‚Üí</button>
      </div>
    </div>
  </section>

  <!-- NYSC corper callout -->
  <section style="background:linear-gradient(135deg,var(--flame),var(--ember));padding:4rem 0">
    <div class="container" style="text-align:center">
      <div style="font-family:'IBM Plex Mono',monospace;font-size:0.62rem;color:rgba(255,255,255,0.6);text-transform:uppercase;letter-spacing:0.18em;margin-bottom:1rem">Highest Commission Tier</div>
      <h2 style="font-family:'Playfair Display',serif;font-size:2.5rem;font-weight:800;color:white;margin-bottom:0.8rem">Corpers earn <em>20% commission.</em></h2>
      <p style="font-size:1rem;color:rgba(255,255,255,0.7);max-width:540px;margin:0 auto 2rem;line-height:1.7">You're at camp with 200‚Äì1,000 other corpers who all need somewhere to live. You know the area. You have the credibility. Every corper who signs a lease through your code earns you ‚Ç¶24,000 on a ‚Ç¶120,000 house.</p>
      <button class="btn" style="background:white;color:var(--flame);font-size:1rem;padding:0.9rem 2.5rem;border-radius:50px" onclick="openModal('authModal','signup')">Get Your Corper Code ‚Üí</button>
    </div>
  </section>

  <!-- Footer -->
  <footer style="background:var(--night);padding:3rem 0 2rem">
    <div class="container">
      <div style="display:grid;grid-template-columns:2fr 1fr 1fr;gap:3rem;margin-bottom:2rem">
        <div>
          <div style="font-family:'Playfair Display',serif;font-size:1.4rem;font-weight:700;color:var(--ivory);margin-bottom:0.7rem">House<span style="color:var(--flame)">Nest</span> Affiliates</div>
          <p style="font-size:0.8rem;color:rgba(244,238,216,0.3);line-height:1.7;max-width:260px">Nigeria's highest-paying property referral programme. Serving Ondo, Ekiti, Oyo, Osun and Kwara states.</p>
        </div>
        <div><div style="color:var(--ivory);font-weight:700;font-size:0.85rem;margin-bottom:0.8rem">Programme</div>
          <div style="display:flex;flex-direction:column;gap:0.45rem">
            <a onclick="document.getElementById('tiers-section').scrollIntoView({behavior:'smooth'})" style="font-size:0.8rem;color:rgba(244,238,216,0.35);cursor:pointer;transition:color 0.2s" onmouseover="this.style.color='rgba(244,238,216,0.7)'" onmouseout="this.style.color='rgba(244,238,216,0.35)'">Commission Tiers</a>
            <a onclick="openModal('authModal','signup')" style="font-size:0.8rem;color:rgba(244,238,216,0.35);cursor:pointer;transition:color 0.2s" onmouseover="this.style.color='rgba(244,238,216,0.7)'" onmouseout="this.style.color='rgba(244,238,216,0.35)'">Join Now</a>
            <a href="#" style="font-size:0.8rem;color:rgba(244,238,216,0.35)">Terms & Conditions</a>
          </div>
        </div>
        <div><div style="color:var(--ivory);font-weight:700;font-size:0.85rem;margin-bottom:0.8rem">Support</div>
          <div style="display:flex;flex-direction:column;gap:0.45rem">
            <a href="mailto:affiliates@housenest.ng" style="font-size:0.8rem;color:rgba(244,238,216,0.35)">affiliates@housenest.ng</a>
            <a href="#" style="font-size:0.8rem;color:rgba(244,238,216,0.35)">WhatsApp Support</a>
            <a href="#" style="font-size:0.8rem;color:rgba(244,238,216,0.35)">FAQ</a>
          </div>
        </div>
      </div>
      <div style="border-top:1px solid rgba(244,238,216,0.06);padding-top:1.5rem;font-size:0.72rem;color:rgba(244,238,216,0.18)">
        ¬© 2025 HouseNest Technology Limited. Affiliate programme terms apply. Commissions paid within 24 hours of withdrawal request via Paystack.
      </div>
    </div>
  </footer>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê JOIN / SIGN UP ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="view" id="view-join">
  <div style="max-width:600px;margin:4rem auto;padding:0 2rem">
    <div style="text-align:center;margin-bottom:2.5rem">
      <div style="font-family:'IBM Plex Mono',monospace;font-size:0.62rem;color:var(--flame);text-transform:uppercase;letter-spacing:0.15em;margin-bottom:0.7rem">Start Earning Today</div>
      <h1 style="font-family:'Playfair Display',serif;font-size:2.2rem;font-weight:700;color:var(--forest)">Join the HouseNest<br>Affiliate Programme</h1>
    </div>
    <!-- Reuse signup form from modal -->
    <div class="dash-panel">
      <div class="dash-panel-body" id="joinFormBody"></div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê AFFILIATE DASHBOARD ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="view" id="view-dashboard">
  <div class="dash-layout">
    <div class="dash-sidebar" id="dashSidebar"></div>
    <div class="dash-main" id="dashMain"></div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ADMIN VIEW ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="view" id="view-admin-view">
  <div style="padding:2rem;max-width:1100px;margin:0 auto">
    <div style="margin-bottom:2rem">
      <div style="font-family:'IBM Plex Mono',monospace;font-size:0.62rem;color:var(--flame);text-transform:uppercase;letter-spacing:0.12em;margin-bottom:0.5rem">Admin Centre</div>
      <h1 style="font-family:'Playfair Display',serif;font-size:1.9rem;font-weight:700;color:var(--forest)">Affiliate Programme Admin</h1>
    </div>
    <div id="adminBody"></div>
  </div>
</div>

</div><!-- end .page -->

<!-- AUTH MODAL -->
<div class="modal-bg" id="authModal" onclick="if(event.target===this)closeModal('authModal')">
  <div class="modal">
    <div class="modal-h">
      <div class="modal-title" id="authTitle">Join the Programme</div>
      <button class="modal-close" onclick="closeModal('authModal')">‚úï</button>
    </div>
    <div class="modal-tabs">
      <button class="mtab active" id="mtab-signup" onclick="switchAuthTab('signup')">Sign Up</button>
      <button class="mtab" id="mtab-login" onclick="switchAuthTab('login')">Log In</button>
    </div>

    <!-- SIGNUP -->
    <div id="signupPanel">
      <div class="f-group">
        <div class="f-label">I am joining as a...</div>
        <div class="role-grid" id="roleGrid">
          <div class="role-card active" data-role="corper" onclick="pickRole(this)">
            <div class="rc-icon">üéì</div>
            <div class="rc-name">NYSC Corper</div>
            <div class="rc-comm">20% commission</div>
          </div>
          <div class="role-card" data-role="influencer" onclick="pickRole(this)">
            <div class="rc-icon">üì±</div>
            <div class="rc-name">Influencer</div>
            <div class="rc-comm">12% commission</div>
          </div>
          <div class="role-card" data-role="agent" onclick="pickRole(this)">
            <div class="rc-icon">üè¢</div>
            <div class="rc-name">Agent / Assoc.</div>
            <div class="rc-comm">15% commission</div>
          </div>
          <div class="role-card" data-role="user" onclick="pickRole(this)">
            <div class="rc-icon">üßë</div>
            <div class="rc-name">General User</div>
            <div class="rc-comm">8% commission</div>
          </div>
        </div>
      </div>
      <div class="f-row">
        <div class="f-group"><label class="f-label">First Name</label><input class="f-input" id="su-first" placeholder="Ngozi"><div class="f-err" id="su-first-err">Required</div></div>
        <div class="f-group"><label class="f-label">Last Name</label><input class="f-input" id="su-last" placeholder="Okafor"><div class="f-err" id="su-last-err">Required</div></div>
      </div>
      <div class="f-group"><label class="f-label">Email</label><input class="f-input" id="su-email" type="email" placeholder="ngozi@email.com"><div class="f-err" id="su-email-err">Enter a valid email</div></div>
      <div class="f-group"><label class="f-label">Phone (WhatsApp)</label><input class="f-input" id="su-phone" type="tel" placeholder="08012345678"><div class="f-err" id="su-phone-err">Enter a valid Nigerian number</div></div>
      <div id="su-nysc-wrap"><div class="f-group"><label class="f-label">NYSC State Code</label><input class="f-input" id="su-nysc" placeholder="e.g. OD/24A/1234"><div class="f-hint">Used to verify corper status and unlock 20% tier</div></div></div>
      <div id="su-influencer-wrap" class="hidden">
        <div class="f-group"><label class="f-label">Social Media Platform</label><select class="f-select" id="su-platform"><option value="">Select platform</option><option>Twitter / X</option><option>Instagram</option><option>TikTok</option><option>Facebook</option><option>YouTube</option></select></div>
        <div class="f-group"><label class="f-label">Profile / Handle URL</label><input class="f-input" id="su-profile" placeholder="https://twitter.com/yourhandle"><div class="f-hint">Must have 5,000+ followers for influencer tier</div></div>
      </div>
      <div id="su-agent-wrap" class="hidden">
        <div class="f-group"><label class="f-label">Business / Association Name</label><input class="f-input" id="su-bizname" placeholder="e.g. Akure Landlord Association"></div>
      </div>
      <div class="f-group"><label class="f-label">Password</label><input class="f-input" id="su-pass" type="password" placeholder="Min. 8 characters"><div class="f-err" id="su-pass-err">Min. 8 characters required</div></div>
      <div class="f-group"><label class="f-label">Confirm Password</label><input class="f-input" id="su-pass2" type="password" placeholder="Repeat password"><div class="f-err" id="su-pass2-err">Passwords do not match</div></div>
      <button class="btn btn-primary btn-full" style="margin-top:0.5rem" onclick="handleSignup()">Create Account & Get My Code ‚Üí</button>
      <p style="font-size:0.72rem;color:var(--smoke);text-align:center;margin-top:0.8rem">By signing up you agree to the <a href="#" style="color:var(--flame)">Affiliate Terms</a></p>
    </div>

    <!-- LOGIN -->
    <div id="loginPanel" class="hidden">
      <div class="f-group"><label class="f-label">Email</label><input class="f-input" id="li-email" type="email" placeholder="your@email.com"><div class="f-err" id="li-email-err">Invalid email</div></div>
      <div class="f-group"><label class="f-label">Password</label><input class="f-input" id="li-pass" type="password" placeholder="Your password"><div class="f-err" id="li-pass-err">Incorrect email or password</div></div>
      <button class="btn btn-primary btn-full" style="margin-top:0.5rem" onclick="handleLogin()">Log In ‚Üí</button>
      <div style="margin-top:1rem;text-align:center;font-size:0.8rem;color:var(--smoke)">No account yet? <span style="color:var(--flame);cursor:pointer;font-weight:700" onclick="switchAuthTab('signup')">Sign up free</span></div>
    </div>
  </div>
</div>

<!-- WITHDRAW MODAL -->
<div class="modal-bg" id="withdrawModal" onclick="if(event.target===this)closeModal('withdrawModal')">
  <div class="modal">
    <div class="modal-h">
      <div class="modal-title">Withdraw Earnings</div>
      <button class="modal-close" onclick="closeModal('withdrawModal')">‚úï</button>
    </div>
    <div id="withdrawBody"></div>
  </div>
</div>

<div class="toast-c" id="toastC"></div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DATA & STORAGE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const DB = {
  get:(k,d)=>{ try{const v=localStorage.getItem('hnaff_'+k); return v!==null?JSON.parse(v):d; }catch{return d;} },
  set:(k,v)=>localStorage.setItem('hnaff_'+k,JSON.stringify(v)),
  del:(k)=>localStorage.removeItem('hnaff_'+k),
};
const hashPass = s => btoa(unescape(encodeURIComponent(s+'hn_aff_salt')));

// ‚îÄ‚îÄ TIER CONFIG ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const TIERS = {
  corper:     { label:'NYSC Corper',    icon:'üéì', rate:0.20, color:'var(--t-corper)',    bg:'rgba(212,78,26,0.10)',   tagClass:'att-corper',    min:5000,  perks:['20% on every tenant referral','15% on every landlord referral','Priority placement in NYSC camp listings','Physical HouseNest corper kit at orientation','WhatsApp support group access','‚Ç¶5,000 bonus after first 5 conversions'] },
  influencer: { label:'Influencer',     icon:'üì±', rate:0.12, color:'var(--t-influencer)',bg:'rgba(156,58,220,0.10)',  tagClass:'att-influencer', min:2000,  perks:['12% on every tenant referral','10% on every landlord referral','Custom branded referral landing page','Monthly performance report','Dedicated account manager (at 20+ referrals)','HouseNest brand assets & content pack'] },
  agent:      { label:'Agent / Assoc.', icon:'üè¢', rate:0.15, color:'var(--t-agent)',     bg:'rgba(26,74,140,0.10)',   tagClass:'att-agent',      min:2000,  perks:['15% on every tenant referral','12% on every landlord referral','Bulk referral dashboard for team management','Sub-affiliate codes for your team members','Priority listing support for associated landlords','Association page on HouseNest platform'] },
  user:       { label:'General User',   icon:'üßë', rate:0.08, color:'var(--t-user)',      bg:'rgba(44,94,50,0.10)',    tagClass:'att-user',       min:2000,  perks:['8% on every tenant referral','5% on every landlord referral','Real-time commission tracking','Instant withdrawal to any bank','Referral leaderboard ranking','Upgrade to higher tier anytime'] },
};

const EARN_ACTIONS = [
  { icon:'üè†',  title:'Tenant Signs Lease',     desc:'A new tenant signs a tenancy agreement through your referral code',              amounts:{corper:'‚Ç¶24,000',influencer:'‚Ç¶14,400',agent:'‚Ç¶18,000',user:'‚Ç¶9,600'} },
  { icon:'üèòÔ∏è', title:'Landlord Lists Property', desc:'A new landlord publishes their first listing after clicking your referral link', amounts:{corper:'‚Ç¶4,500',influencer:'‚Ç¶3,600',agent:'‚Ç¶4,500',user:'‚Ç¶2,400'} },
  { icon:'üîë',  title:'Shortlet Booking',        desc:'A guest books a shortlet through your link (commission on nightly rate)',        amounts:{corper:'‚Ç¶2,400',influencer:'‚Ç¶1,440',agent:'‚Ç¶1,800',user:'‚Ç¶960'} },
  { icon:'‚≠ê',  title:'Verified Referral Bonus', desc:'Referree completes full KYC verification within 7 days of signing up',          amounts:{corper:'‚Ç¶1,000',influencer:'‚Ç¶500',agent:'‚Ç¶750',user:'‚Ç¶250'} },
  { icon:'üéì',  title:'Corper-to-Corper Bonus',  desc:'Corpers earn extra when they refer another corper in the same NYSC batch',      amounts:{corper:'‚Ç¶2,000',influencer:'N/A',agent:'N/A',user:'N/A'} },
  { icon:'üè¢',  title:'Association Bulk Deal',   desc:'Agent/Association closes a bulk deal (5+ listings from one landlord)',          amounts:{corper:'N/A',influencer:'N/A',agent:'‚Ç¶15,000',user:'N/A'} },
];

// ‚îÄ‚îÄ SEED DEMO DATA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function seedData() {
  if (DB.get('seeded', false)) return;

  const demoAffiliates = [
    { id:'a1', firstName:'Chidi', lastName:'Okonkwo', email:'chidi@demo.ng', phone:'08011111111', role:'corper',     nysc:'OD/24A/0021', code:'CORPER-CHIDI-ODO', status:'active',  earnings:142000, pending:18000, paid:124000, referrals:12, conversions:8,  joinDate:Date.now()-86400000*45, platform:'', profileUrl:'', password:hashPass('demo') },
    { id:'a2', firstName:'Temi',  lastName:'Adeyemi',  email:'temi@demo.ng',  phone:'08022222222', role:'influencer', nysc:'',           code:'INFL-TEMI-HN24',   status:'active',  earnings:89000,  pending:8000,  paid:81000,  referrals:28, conversions:19, joinDate:Date.now()-86400000*30, platform:'Instagram', profileUrl:'https://instagram.com/temi', password:hashPass('demo') },
    { id:'a3', firstName:'Emeka', lastName:'Nwosu',    email:'emeka@demo.ng', phone:'08033333333', role:'agent',      nysc:'',           code:'AGT-EMEKA-IB001',  status:'active',  earnings:210000, pending:24000, paid:186000, referrals:41, conversions:31, joinDate:Date.now()-86400000*60, platform:'', profileUrl:'', password:hashPass('demo') },
    { id:'a4', firstName:'Amaka', lastName:'Eze',      email:'amaka@demo.ng', phone:'08044444444', role:'user',       nysc:'',           code:'USR-AMAKA-HN25',   status:'pending', earnings:12000,  pending:4000,  paid:8000,   referrals:5,  conversions:2,  joinDate:Date.now()-86400000*7,  platform:'', profileUrl:'', password:hashPass('demo') },
  ];

  const demoCommissions = [
    { id:'c1',affiliateId:'a1',action:'Tenant Signed Lease',listing:'Self-Contain, Akure GRA',amount:24000,status:'paid',date:Date.now()-86400000*3 },
    { id:'c2',affiliateId:'a1',action:'Landlord Listed Property',listing:'Mini Flat, Ondo City',amount:4500,status:'paid',date:Date.now()-86400000*5 },
    { id:'c3',affiliateId:'a1',action:'Tenant Signed Lease',listing:'Room & Parlour, Ile-Ife',amount:24000,status:'processing',date:Date.now()-86400000*1 },
    { id:'c4',affiliateId:'a2',action:'Shortlet Booking',listing:'Studio, Ado-Ekiti GRA',amount:1440,status:'paid',date:Date.now()-86400000*2 },
    { id:'c5',affiliateId:'a2',action:'Tenant Signed Lease',listing:'2-Bed Flat, Ibadan GRA',amount:14400,status:'pending',date:Date.now()-86400000*1 },
    { id:'c6',affiliateId:'a3',action:'Association Bulk Deal',listing:'5 Listings ‚Äî Ilorin',amount:15000,status:'paid',date:Date.now()-86400000*4 },
    { id:'c7',affiliateId:'a3',action:'Tenant Signed Lease',listing:'Bedsitter, Osogbo',amount:18000,status:'processing',date:Date.now()-86400000*0.5 },
    { id:'c8',affiliateId:'a4',action:'Tenant Signed Lease',listing:'Self-Contain, Akure',amount:9600,status:'pending',date:Date.now()-86400000*2 },
  ];

  DB.set('affiliates', demoAffiliates);
  DB.set('commissions', demoCommissions);
  DB.set('seeded', true);
}

// ‚îÄ‚îÄ APP STATE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let currentUser = DB.get('currentUser', null);
let selectedRole = 'corper';
let dashPanel = 'overview';

// ‚îÄ‚îÄ CODE GENERATION ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function genCode(role, firstName) {
  const prefixes = { corper:'CORPER', influencer:'INFL', agent:'AGT', user:'USR' };
  const prefix = prefixes[role] || 'HN';
  const name = firstName.toUpperCase().slice(0,5).replace(/[^A-Z]/g,'');
  const year = new Date().getFullYear().toString().slice(2);
  const rand = Math.random().toString(36).slice(2,6).toUpperCase();
  return `${prefix}-${name}-${rand}${year}`;
}

function getReferralLink(code) {
  return `https://housenest.ng/ref/${code}`;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// NAVIGATION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function showView(id, btn, skipAuth=false) {
  if ((id==='dashboard' || id==='admin-view') && !currentUser) {
    openModal('authModal','login');
    return;
  }
  document.querySelectorAll('.view').forEach(v=>v.classList.remove('active'));
  document.getElementById('view-'+id)?.classList.add('active');
  if (btn) { document.querySelectorAll('.ntab').forEach(t=>t.classList.remove('active')); btn.classList.add('active'); }
  window.scrollTo(0,0);
  if (id==='dashboard') renderDashboard();
  if (id==='admin-view') renderAdmin();
}
function goHome() { showView('home', document.querySelector('.ntab')); }
function requireAuth(cb, adminOnly=false) {
  if (!currentUser) { openModal('authModal','login'); return; }
  if (adminOnly && !currentUser.isAdmin) { toast('warn','Admin access required'); return; }
  cb();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// HOME PAGE RENDERING
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderHome() {
  renderHeroPreviews();
  renderTiersGrid();
  renderEarnsGrid();
  renderEarningsCalc();
}

function renderHeroPreviews() {
  const container = document.getElementById('heroPreviews');
  if (!container) return;
  const items = [
    { role:'corper', name:'Chidi (Ondo State)', refs:12, earned:'‚Ç¶142,000', badge:'üéì Corper' },
    { role:'influencer', name:'Temi (@temiadeyemi)', refs:28, earned:'‚Ç¶89,000', badge:'üì± Influencer' },
    { role:'agent', name:'Emeka Properties', refs:41, earned:'‚Ç¶210,000', badge:'üè¢ Agent' },
  ];
  container.innerHTML = items.map(u => {
    const t = TIERS[u.role];
    return `<div class="tier-preview-card" onclick="openModal('authModal','signup')">
      <div class="tpc-tag" style="color:${t.color}">${u.badge}</div>
      <div class="tpc-name">${u.name}</div>
      <div style="display:flex;justify-content:space-between;align-items:flex-end;margin-top:0.4rem">
        <div><div style="font-size:0.65rem;color:rgba(244,238,216,0.35);margin-bottom:0.2rem">Earned this month</div>
        <div class="tpc-commission" style="color:${t.color}">${u.earned}</div></div>
        <div style="text-align:right"><div style="font-size:0.65rem;color:rgba(244,238,216,0.35)">Referrals</div><div style="font-family:'IBM Plex Mono',monospace;font-size:1.1rem;color:rgba(244,238,216,0.7)">${u.refs}</div></div>
      </div>
      <div class="tpc-desc">${(t.rate*100).toFixed(0)}% commission ¬∑ ${t.perks[0]}</div>
    </div>`;
  }).join('');
}

function renderTiersGrid() {
  const grid = document.getElementById('tiersGrid');
  if (!grid) return;
  grid.innerHTML = Object.entries(TIERS).map(([key, t]) => `
  <div class="tier-card ${key==='corper'?'featured':''}" onclick="openModal('authModal','signup')">
    ${key==='corper'?'<div class="featured-ribbon">üî• Highest Rate</div>':''}
    <div class="tc-header">
      <div class="tc-icon" style="background:${t.bg}">${t.icon}</div>
      <div class="tc-tag" style="color:${t.color}">${key==='corper'?'üéì NYSC Corpers':key==='influencer'?'üì± Social Media Influencers':key==='agent'?'üè¢ Agents & Associations':'üßë General Users'}</div>
      <div class="tc-name">${t.label}</div>
      <div class="tc-commission-label">Commission Rate</div>
      <div class="tc-commission" style="color:${t.color}">${(t.rate*100).toFixed(0)}%</div>
      <div class="tc-per">per successful referral</div>
    </div>
    <hr class="tc-divider">
    <div class="tc-body">
      <div class="tc-perks">${t.perks.map(p=>`<div class="tc-perk"><span class="tc-perk-icon" style="color:${t.color}">‚úì</span>${p}</div>`).join('')}</div>
      <button class="btn btn-full btn-sm" style="background:${t.bg};color:${t.color};border:1px solid ${t.color}22" onclick="event.stopPropagation();openModal('authModal','signup')">Join as ${t.label} ‚Üí</button>
    </div>
  </div>`).join('');
}

function renderEarnsGrid() {
  const g = document.getElementById('earnsGrid');
  if (!g) return;
  g.innerHTML = EARN_ACTIONS.map(a => `
  <div style="background:rgba(244,238,216,0.05);border:1px solid rgba(244,238,216,0.08);border-radius:16px;padding:1.4rem;transition:all 0.2s" onmouseover="this.style.background='rgba(244,238,216,0.09)'" onmouseout="this.style.background='rgba(244,238,216,0.05)'">
    <div style="font-size:1.6rem;margin-bottom:0.8rem">${a.icon}</div>
    <div style="font-weight:700;color:var(--ivory);font-size:0.92rem;margin-bottom:0.35rem">${a.title}</div>
    <div style="font-size:0.75rem;color:rgba(244,238,216,0.4);line-height:1.6;margin-bottom:0.9rem">${a.desc}</div>
    <div style="display:flex;flex-wrap:wrap;gap:0.3rem">
      ${Object.entries(a.amounts).map(([role,amt])=>amt!=='N/A'?`<span style="background:${TIERS[role].bg};color:${TIERS[role].color};padding:0.18rem 0.5rem;border-radius:50px;font-size:0.62rem;font-weight:700;font-family:'IBM Plex Mono',monospace">${TIERS[role].icon} ${amt}</span>`:`<span style="background:rgba(244,238,216,0.05);color:rgba(244,238,216,0.2);padding:0.18rem 0.5rem;border-radius:50px;font-size:0.62rem">N/A</span>`).join('')}
    </div>
  </div>`).join('');
}

function renderEarningsCalc() {
  const el = document.getElementById('earningsCalc');
  if (!el) return;
  const items = [
    {label:'5 tenants / month',perRef:14400,refs:5},
    {label:'10 tenants / month',perRef:14400,refs:10},
    {label:'20 tenants / month',perRef:14400,refs:20},
  ];
  el.innerHTML = items.map(i => `
  <div style="display:flex;justify-content:space-between;align-items:center;padding:0.6rem 0;border-bottom:1px solid rgba(244,238,216,0.08)">
    <span style="font-size:0.8rem;color:rgba(244,238,216,0.55)">${i.label}</span>
    <span style="font-family:'IBM Plex Mono',monospace;font-weight:700;color:var(--mint);font-size:0.9rem">‚Ç¶${(i.perRef*i.refs).toLocaleString()}</span>
  </div>`).join('');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// AUTH
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function switchAuthTab(tab) {
  document.getElementById('mtab-signup').classList.toggle('active', tab==='signup');
  document.getElementById('mtab-login').classList.toggle('active', tab==='login');
  document.getElementById('signupPanel').classList.toggle('hidden', tab!=='signup');
  document.getElementById('loginPanel').classList.toggle('hidden', tab!=='login');
  document.getElementById('authTitle').textContent = tab==='signup' ? 'Join the Programme' : 'Welcome Back';
}

function pickRole(el) {
  document.querySelectorAll('.role-card').forEach(c=>c.classList.remove('active'));
  el.classList.add('active');
  selectedRole = el.dataset.role;
  document.getElementById('su-nysc-wrap').classList.toggle('hidden', selectedRole!=='corper');
  document.getElementById('su-influencer-wrap').classList.toggle('hidden', selectedRole!=='influencer');
  document.getElementById('su-agent-wrap').classList.toggle('hidden', selectedRole!=='agent');
}

function clearErr(...ids) { ids.forEach(id=>document.getElementById(id)?.classList.remove('show')); }
function showErr(id,msg='') { const el=document.getElementById(id); if(el){if(msg)el.textContent=msg; el.classList.add('show');} }
function validEmail(e) { return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e); }
function validPhone(p) { return /^0[789]\d{9}$/.test(p.replace(/\s/g,'')); }

function handleSignup() {
  clearErr('su-first-err','su-last-err','su-email-err','su-phone-err','su-pass-err','su-pass2-err');
  const first=document.getElementById('su-first').value.trim();
  const last=document.getElementById('su-last').value.trim();
  const email=document.getElementById('su-email').value.trim();
  const phone=document.getElementById('su-phone').value.trim();
  const pass=document.getElementById('su-pass').value;
  const pass2=document.getElementById('su-pass2').value;
  const nysc=document.getElementById('su-nysc')?.value.trim()||'';
  const platform=document.getElementById('su-platform')?.value||'';
  const profileUrl=document.getElementById('su-profile')?.value.trim()||'';
  const bizname=document.getElementById('su-bizname')?.value.trim()||'';

  let ok=true;
  if(!first){showErr('su-first-err');ok=false;}
  if(!last){showErr('su-last-err');ok=false;}
  if(!validEmail(email)){showErr('su-email-err');ok=false;}
  if(!validPhone(phone)){showErr('su-phone-err','Enter valid 11-digit Nigerian number');ok=false;}
  if(pass.length<8){showErr('su-pass-err');ok=false;}
  if(pass!==pass2){showErr('su-pass2-err');ok=false;}
  if(!ok) return;

  const affiliates = DB.get('affiliates',[]);
  if(affiliates.find(a=>a.email===email)){showErr('su-email-err','Email already registered');return;}

  const code = genCode(selectedRole, first);
  const newAffiliate = {
    id:'a'+Date.now(),
    firstName:first, lastName:last, email, phone,
    role:selectedRole, nysc, platform, profileUrl, bizname,
    code, status:selectedRole==='user'?'active':'pending',
    earnings:0, pending:0, paid:0, referrals:0, conversions:0,
    joinDate:Date.now(),
    password:hashPass(pass),
    isAdmin:false,
  };
  affiliates.push(newAffiliate);
  DB.set('affiliates', affiliates);
  currentUser = newAffiliate;
  DB.set('currentUser', newAffiliate);
  updateNavState();
  closeModal('authModal');
  showView('dashboard', null);
  toast('ok','üéâ Welcome! Your code is '+code);
}

function handleLogin() {
  clearErr('li-email-err','li-pass-err');
  const email=document.getElementById('li-email').value.trim();
  const pass=document.getElementById('li-pass').value;
  if(!validEmail(email)){showErr('li-email-err');return;}

  // Admin shortcut
  if(email==='admin@housenest.ng' && pass==='admin2025') {
    currentUser = {id:'admin',firstName:'Admin',lastName:'HN',email,role:'admin',isAdmin:true,code:'ADMIN',status:'active',earnings:0,pending:0,paid:0,referrals:0,conversions:0};
    DB.set('currentUser',currentUser);
    updateNavState();
    closeModal('authModal');
    showView('admin-view',null);
    return;
  }

  const affiliates = DB.get('affiliates',[]);
  const user = affiliates.find(a=>a.email===email);
  if(!user||user.password!==hashPass(pass)){showErr('li-pass-err');return;}
  currentUser=user;
  DB.set('currentUser',user);
  updateNavState();
  closeModal('authModal');
  showView('dashboard',null);
  toast('ok','Welcome back, '+user.firstName+'!');
}

function logout() {
  currentUser=null;
  DB.del('currentUser');
  updateNavState();
  showView('home',document.querySelector('.ntab'));
  toast('ok','Logged out successfully');
}

function updateNavState() {
  const gu=document.getElementById('guestNav');
  const un=document.getElementById('userNav');
  const av=document.getElementById('userAv');
  if(currentUser) {
    gu.style.display='none';
    un.style.display='flex';
    av.textContent=currentUser.firstName[0]+(currentUser.lastName?currentUser.lastName[0]:'');
    av.style.background=avatarColor(currentUser.firstName);
  } else {
    gu.style.display='flex';
    un.style.display='none';
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DASHBOARD
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderDashboard() {
  if(!currentUser) return;
  const u = currentUser;
  const t = TIERS[u.role]||TIERS.user;
  const commissions = DB.get('commissions',[]).filter(c=>c.affiliateId===u.id);

  // Sidebar
  document.getElementById('dashSidebar').innerHTML = `
  <div class="ds-user-block">
    <div class="ds-user-av" style="background:${avatarColor(u.firstName)}">${u.firstName[0]}${u.lastName?u.lastName[0]:''}</div>
    <div>
      <div class="ds-user-name">${u.firstName} ${u.lastName}</div>
      <div class="ds-user-tier">${t.icon} ${t.label}</div>
      <div class="ds-tier-badge" style="background:${t.bg};color:${t.color}">${(t.rate*100).toFixed(0)}% commission</div>
    </div>
  </div>
  <div class="ds-label">Main</div>
  <button class="ds-btn ${dashPanel==='overview'?'active':''}" onclick="switchDashPanel('overview',this)"><span class="ds-icon">üìä</span>Overview</button>
  <button class="ds-btn ${dashPanel==='mycode'?'active':''}" onclick="switchDashPanel('mycode',this)"><span class="ds-icon">üîó</span>My Referral Code</button>
  <button class="ds-btn ${dashPanel==='commissions'?'active':''}" onclick="switchDashPanel('commissions',this)"><span class="ds-icon">üí∞</span>Commissions <span class="ds-badge">${commissions.filter(c=>c.status==='pending').length||''}</span></button>
  <div class="ds-label">Community</div>
  <button class="ds-btn ${dashPanel==='leaderboard'?'active':''}" onclick="switchDashPanel('leaderboard',this)"><span class="ds-icon">üèÜ</span>Leaderboard</button>
  <button class="ds-btn ${dashPanel==='tools'?'active':''}" onclick="switchDashPanel('tools',this)"><span class="ds-icon">üõ†Ô∏è</span>Marketing Tools</button>
  <div class="ds-label">Account</div>
  <button class="ds-btn" onclick="switchDashPanel('profile',this)"><span class="ds-icon">üë§</span>My Profile</button>
  <button class="ds-btn" onclick="logout()"><span class="ds-icon">üö™</span>Log Out</button>`;

  switchDashPanel(dashPanel, null);
}

function switchDashPanel(panel, btn) {
  dashPanel = panel;
  if(btn){ document.querySelectorAll('.ds-btn').forEach(b=>b.classList.remove('active')); btn.classList.add('active'); }
  const u = currentUser;
  const t = TIERS[u.role]||TIERS.user;
  const commissions = DB.get('commissions',[]).filter(c=>c.affiliateId===u.id);
  const affiliates = DB.get('affiliates',[]);
  const main = document.getElementById('dashMain');

  if(panel==='overview') {
    const greeting = ['morning','afternoon','evening'][Math.floor(new Date().getHours()/8.01)];
    main.innerHTML = `
    <div class="dp-title">Good ${greeting}, ${u.firstName} üëã</div>
    <div class="dp-sub">Your referral programme dashboard ¬∑ Code: <span style="font-family:'IBM Plex Mono',monospace;color:${t.color};font-weight:700">${u.code}</span> ${u.status==='pending'?'<span style="background:rgba(200,120,32,0.12);color:var(--amber);padding:0.15rem 0.5rem;border-radius:50px;font-size:0.7rem;font-weight:700;margin-left:0.5rem">‚è≥ Pending Approval</span>':''}</div>
    <div class="stats-row">
      <div class="stat-card"><div class="stat-n">‚Ç¶${(u.earnings||0).toLocaleString()}</div><div class="stat-l">Total Earned</div><div class="stat-delta stat-up">+‚Ç¶${(u.pending||0).toLocaleString()} pending</div></div>
      <div class="stat-card"><div class="stat-n">${u.referrals||0}</div><div class="stat-l">Total Referrals</div></div>
      <div class="stat-card"><div class="stat-n">${u.conversions||0}</div><div class="stat-l">Conversions</div><div class="stat-delta">${u.referrals>0?((u.conversions/u.referrals)*100).toFixed(0)+'% rate':'‚Äî'}</div></div>
      <div class="stat-card"><div class="stat-n">‚Ç¶${(u.paid||0).toLocaleString()}</div><div class="stat-l">Paid Out</div></div>
    </div>
    <div class="code-card">
      <div class="code-card-label">Your Unique Referral Code</div>
      <div class="code-display">
        <span>${u.code}</span>
        <button class="code-copy-btn" onclick="copyCode('${u.code}')">üìã Copy Code</button>
      </div>
      <div class="code-link">housenest.ng/ref/${u.code}</div>
      <div class="code-share-row">
        <button class="share-btn share-twitter" onclick="shareToSocial('twitter','${u.code}')">ùïè Twitter</button>
        <button class="share-btn share-whatsapp" onclick="shareToSocial('whatsapp','${u.code}')">üí¨ WhatsApp</button>
        <button class="share-btn share-instagram" onclick="shareToSocial('instagram','${u.code}')">üì∏ Instagram</button>
        <button class="share-btn share-facebook" onclick="shareToSocial('facebook','${u.code}')">üëç Facebook</button>
        <button class="share-btn share-copy" onclick="copyLink('${u.code}')">üîó Copy Link</button>
      </div>
    </div>
    <div class="dash-panel">
      <div class="dash-panel-header"><div class="dph-title">Recent Activity</div></div>
      <div class="dash-panel-body">
        ${commissions.length===0?'<p style="color:var(--smoke);font-size:0.85rem">No activity yet. Share your code to start earning!</p>':
        `<table class="comm-table"><thead><tr><th>Action</th><th>Listing</th><th>Commission</th><th>Status</th><th>Date</th></tr></thead><tbody>
        ${commissions.slice(-5).reverse().map(c=>`<tr>
          <td>${c.action}</td>
          <td style="max-width:160px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${c.listing}</td>
          <td class="comm-amount">‚Ç¶${c.amount.toLocaleString()}</td>
          <td><span class="comm-${c.status}">${c.status.charAt(0).toUpperCase()+c.status.slice(1)}</span></td>
          <td style="color:var(--smoke);font-size:0.75rem">${timeAgo(c.date)}</td>
        </tr>`).join('')}
        </tbody></table>`}
      </div>
    </div>
    ${u.status==='active'?`
    <div style="display:flex;gap:0.8rem;flex-wrap:wrap">
      <button class="btn btn-ok" onclick="openWithdrawModal()">üí∏ Withdraw Earnings</button>
      <button class="btn btn-outline" onclick="switchDashPanel('mycode',null)">üîó Share My Code</button>
    </div>`:'<div style="background:rgba(200,120,32,0.08);border:1px solid rgba(200,120,32,0.2);border-radius:12px;padding:1.2rem;font-size:0.85rem;color:var(--amber)"><strong>‚è≥ Account Pending:</strong> Your account is awaiting approval by the HouseNest team. We\'ll send you an SMS and email within 24 hours. Once approved, you can start sharing your code.</div>'}`;
  }

  else if(panel==='mycode') {
    main.innerHTML = `
    <div class="dp-title">My Referral Code</div>
    <div class="dp-sub">Share this code everywhere. Every conversion earns you ${(t.rate*100).toFixed(0)}% commission.</div>
    <div class="code-card">
      <div class="code-card-label">Your Unique Code</div>
      <div class="code-display"><span>${u.code}</span><button class="code-copy-btn" onclick="copyCode('${u.code}')">üìã Copy</button></div>
      <div class="code-link">${getReferralLink(u.code)}</div>
      <div class="code-share-row">
        <button class="share-btn share-twitter" onclick="shareToSocial('twitter','${u.code}')">ùïè Twitter</button>
        <button class="share-btn share-whatsapp" onclick="shareToSocial('whatsapp','${u.code}')">üí¨ WhatsApp</button>
        <button class="share-btn share-instagram" onclick="shareToSocial('instagram','${u.code}')">üì∏ Instagram</button>
        <button class="share-btn share-facebook" onclick="shareToSocial('facebook','${u.code}')">üëç Facebook</button>
        <button class="share-btn share-copy" onclick="copyLink('${u.code}')">üîó Copy Link</button>
      </div>
    </div>
    <div class="dash-panel">
      <div class="dash-panel-header"><div class="dph-title">Suggested Copy for Each Platform</div></div>
      <div class="dash-panel-body">${renderPlatformCopy(u)}</div>
    </div>
    <div class="dash-panel">
      <div class="dash-panel-header"><div class="dph-title">QR Code</div></div>
      <div class="dash-panel-body" style="text-align:center;padding:2rem">
        <div style="width:140px;height:140px;background:var(--mist);border-radius:12px;margin:0 auto 1rem;display:flex;align-items:center;justify-content:center;font-size:3rem">üî≥</div>
        <p style="font-size:0.82rem;color:var(--smoke)">QR code pointing to your referral link.<br>In production: generated via qr-server.com API.</p>
        <button class="btn btn-outline btn-sm" style="margin-top:0.8rem" onclick="toast('ok','QR code downloaded! (Demo mode)')">‚¨áÔ∏è Download QR Code</button>
      </div>
    </div>`;
  }

  else if(panel==='commissions') {
    const total = commissions.reduce((s,c)=>s+c.amount,0);
    const pending = commissions.filter(c=>c.status==='pending').reduce((s,c)=>s+c.amount,0);
    const paid = commissions.filter(c=>c.status==='paid').reduce((s,c)=>s+c.amount,0);
    main.innerHTML = `
    <div class="dp-title">My Commissions</div>
    <div class="dp-sub">${commissions.length} commission event${commissions.length!==1?'s':''} recorded</div>
    <div class="stats-row">
      <div class="stat-card"><div class="stat-n">‚Ç¶${total.toLocaleString()}</div><div class="stat-l">Total Earned</div></div>
      <div class="stat-card"><div class="stat-n" style="color:var(--amber)">‚Ç¶${pending.toLocaleString()}</div><div class="stat-l">Pending</div></div>
      <div class="stat-card"><div class="stat-n" style="color:var(--ok)">‚Ç¶${paid.toLocaleString()}</div><div class="stat-l">Paid Out</div></div>
      <div class="stat-card"><div class="stat-n">${(t.rate*100).toFixed(0)}%</div><div class="stat-l">Your Rate</div></div>
    </div>
    <div class="dash-panel">
      <div class="dash-panel-header">
        <div class="dph-title">All Commission Events</div>
        ${commissions.some(c=>c.status==='pending')?`<button class="btn btn-ok btn-sm" onclick="openWithdrawModal()">üí∏ Withdraw Available</button>`:''}
      </div>
      <div class="dash-panel-body">
        ${commissions.length===0?'<p style="color:var(--smoke);font-size:0.85rem">No commissions yet. Share your code to start earning!</p>':
        `<table class="comm-table" style="width:100%"><thead><tr><th>Action</th><th>Listing</th><th>Amount</th><th>Status</th><th>Date</th></tr></thead><tbody>
        ${[...commissions].reverse().map(c=>`<tr>
          <td style="font-weight:600">${c.action}</td>
          <td style="max-width:180px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;color:var(--smoke)">${c.listing}</td>
          <td class="comm-amount">‚Ç¶${c.amount.toLocaleString()}</td>
          <td><span class="comm-${c.status}">${c.status.charAt(0).toUpperCase()+c.status.slice(1)}</span></td>
          <td style="color:var(--smoke);font-size:0.75rem;white-space:nowrap">${timeAgo(c.date)}</td>
        </tr>`).join('')}
        </tbody></table>`}
      </div>
    </div>`;
  }

  else if(panel==='leaderboard') {
    const allAff = DB.get('affiliates',[]).filter(a=>a.status==='active').sort((a,b)=>(b.earnings||0)-(a.earnings||0));
    const myRank = allAff.findIndex(a=>a.id===u.id)+1;
    main.innerHTML = `
    <div class="dp-title">üèÜ Leaderboard</div>
    <div class="dp-sub">Top earners across all tiers this month${myRank>0?` ¬∑ You are ranked #${myRank}`:''}</div>
    <div class="dash-panel"><div class="dash-panel-body">
      ${allAff.map((a,i)=>{
        const at=TIERS[a.role]||TIERS.user;
        return `<div class="lb-row ${a.id===u.id?'':''}">
          <div class="lb-rank ${i===0?'lb-rank-1':i===1?'lb-rank-2':i===2?'lb-rank-3':''}">${i===0?'ü•á':i===1?'ü•à':i===2?'ü•â':'#'+(i+1)}</div>
          <div class="lb-av" style="background:${avatarColor(a.firstName)}">${a.firstName[0]}${a.lastName?a.lastName[0]:''}</div>
          <div>
            <div class="lb-name">${a.firstName} ${a.lastName} ${a.id===u.id?'<span style="font-size:0.65rem;background:rgba(44,94,50,0.12);color:var(--moss);padding:0.1rem 0.4rem;border-radius:50px">(You)</span>':''}</div>
            <div class="lb-meta"><span class="aff-tier-tag ${at.tagClass}">${at.icon} ${at.label}</span></div>
          </div>
          <div style="margin-left:auto;text-align:right">
            <div class="lb-earnings">‚Ç¶${(a.earnings||0).toLocaleString()}</div>
            <div class="lb-refs">${a.conversions||0} conversions ¬∑ ${a.referrals||0} referrals</div>
          </div>
        </div>`;}).join('')||'<p style="color:var(--smoke)">No affiliates yet ‚Äî be the first!</p>'}
    </div></div>`;
  }

  else if(panel==='tools') {
    main.innerHTML = `
    <div class="dp-title">üõ†Ô∏è Marketing Tools</div>
    <div class="dp-sub">Resources to help you convert more referrals</div>
    ${[
      {icon:'üìù',title:'Ready-Made Caption Templates',desc:'Copy-paste captions for Twitter, Instagram, WhatsApp Status and Facebook tailored to your tier.',action:'getCaptions'},
      {icon:'üñºÔ∏è',title:'HouseNest Brand Assets',desc:'Logo, banner images, and colour palette files for use in your posts. Already sized for each platform.',action:'getBranding'},
      {icon:'üìä',title:'Referral Tracking Link',desc:'Your link with UTM parameters so you can track exactly where your referrals are coming from.',action:'getUtm'},
      {icon:'üéì',title:'NYSC Camp Pitch Script',desc:'A 60-second verbal pitch for corper-to-corper marketing at orientation camp and CDS meetings.',action:'getPitch'},
    ].map(t=>`
    <div class="dash-panel" style="margin-bottom:1rem">
      <div class="dash-panel-body" style="display:flex;align-items:flex-start;gap:1rem">
        <div style="font-size:1.8rem;flex-shrink:0">${t.icon}</div>
        <div style="flex:1">
          <div style="font-weight:700;color:var(--forest);margin-bottom:0.3rem">${t.title}</div>
          <div style="font-size:0.82rem;color:var(--smoke);line-height:1.6">${t.desc}</div>
        </div>
        <button class="btn btn-outline btn-sm" style="flex-shrink:0" onclick="${t.action}('${u.code}','${u.role}')">Get ‚Üí</button>
      </div>
    </div>`).join('')}`;
  }

  else if(panel==='profile') {
    main.innerHTML = `
    <div class="dp-title">My Profile</div>
    <div class="dp-sub">Update your information</div>
    <div class="dash-panel"><div class="dash-panel-body">
      <div class="f-row">
        <div class="f-group"><label class="f-label">First Name</label><input class="f-input" id="pf-first" value="${u.firstName}"></div>
        <div class="f-group"><label class="f-label">Last Name</label><input class="f-input" id="pf-last" value="${u.lastName||''}"></div>
      </div>
      <div class="f-group"><label class="f-label">Email</label><input class="f-input" id="pf-email" type="email" value="${u.email}"></div>
      <div class="f-group"><label class="f-label">Phone</label><input class="f-input" id="pf-phone" value="${u.phone||''}"></div>
      ${u.role==='corper'?`<div class="f-group"><label class="f-label">NYSC Code</label><input class="f-input" id="pf-nysc" value="${u.nysc||''}"></div>`:''}
      ${u.role==='influencer'?`
      <div class="f-row">
        <div class="f-group"><label class="f-label">Platform</label><input class="f-input" id="pf-platform" value="${u.platform||''}"></div>
        <div class="f-group"><label class="f-label">Profile URL</label><input class="f-input" id="pf-profile" value="${u.profileUrl||''}"></div>
      </div>`:''}
      <div class="f-group"><label class="f-label">New Password (leave blank to keep)</label><input class="f-input" id="pf-pass" type="password" placeholder="New password"></div>
      <button class="btn btn-primary" onclick="saveProfile()">Save Changes</button>
    </div></div>
    <div class="dash-panel"><div class="dash-panel-body">
      <div style="font-weight:700;color:var(--forest);margin-bottom:0.8rem">Bank Account for Withdrawals</div>
      <div class="f-row">
        <div class="f-group"><label class="f-label">Bank Name</label>
          <select class="f-select" id="pf-bank"><option value="">Select Bank</option><option>Access Bank</option><option>GTBank</option><option>First Bank</option><option>UBA</option><option>Zenith Bank</option><option>Opay</option><option>Kuda</option></select></div>
        <div class="f-group"><label class="f-label">Account Number</label><input class="f-input" id="pf-accnum" placeholder="0123456789" maxlength="10" style="font-family:'IBM Plex Mono',monospace"></div>
      </div>
      <div class="f-group"><label class="f-label">Account Name</label><input class="f-input" id="pf-accname" placeholder="As it appears on your bank account"></div>
      <button class="btn btn-outline btn-sm" onclick="toast('ok','‚úÖ Bank account saved! Withdrawals will be sent here.')">Save Bank Details</button>
    </div></div>`;
  }
}

// Helpers for marketing tools
function getCaptions(code, role) {
  const captions = {
    corper:`Twitter: "Corpers! üéì Tired of searching for decent accommodation after camp? Use my HouseNest code ${code} to find verified, affordable housing in your state of deployment. Zero agent fees, legal agreement included. housenest.ng/ref/${code}"

WhatsApp: "Hey guys üëã If you're still searching for accommodation, try HouseNest ‚Äî real verified landlords, no agent nonsense. Use my code ${code} and get direct access to hundreds of listings in your state. Link: housenest.ng/ref/${code}"`,
    influencer:`Twitter: "Finding a home in a new city shouldn't be stressful üè° HouseNest is changing how Nigerians rent ‚Äî verified landlords, free escrow protection, and ZERO agent fees. Use my link to browse listings in Ondo, Ekiti, Oyo, Osun & Kwara. housenest.ng/ref/${code}"

Instagram caption: "New city, new chapter ‚ú® Whether you're a corper, student, or relocating for work ‚Äî HouseNest connects you directly to verified landlords with no agent in between. I've partnered with them and my link is in bio! Code: ${code}"`,
    agent:`WhatsApp Broadcast: "Looking for accommodation in [STATE]? I've partnered with HouseNest ‚Äî Nigeria's most trusted rental platform. Browse verified listings, sign agreements online, pay with escrow protection. Use code ${code} or visit housenest.ng/ref/${code}"`,
    user:`"Looking for a place? Try HouseNest ‚Äî real listings, real landlords, no agent fees. Use my code ${code}: housenest.ng/ref/${code}"`,
  };
  showTextModal('Caption Templates', (captions[role]||captions.user).replace(/\n/g,'<br><br>'));
}

function getPitch(code) {
  showTextModal('NYSC Camp 60-Second Pitch', `<em>"Hey, are you still searching for accommodation? Because I found something that completely sorted me out."</em><br><br>
  <strong>Pause. Let them respond.</strong><br><br>
  <em>"It's called HouseNest ‚Äî it's basically a property platform but built specifically for corpers. You can browse verified listings directly in whatever state you've been posted to. No agent, no commission, no wahala. The landlord has already been verified, the agreement is already drafted ‚Äî you just sign and move in."</em><br><br>
  <em>"And because I'm also on their affiliate programme, I have a personal code: ${code}. When you sign a lease using that code, I earn a little commission ‚Äî but it costs you nothing extra. The platform is completely free for tenants."</em><br><br>
  <em>"Just go to housenest.ng and type in my code when you search. Or I'll send you the link on WhatsApp right now."</em>`);
}
function getBranding(code) { showTextModal('Brand Assets', 'In production: ZIP file with HouseNest logo (SVG, PNG), pre-designed Instagram Stories templates, WhatsApp Status banners, and Twitter header images ‚Äî all with your referral code embedded.<br><br>Colours: Forest Green #1a3a1e ¬∑ Flame Orange #d44e1a ¬∑ Ivory #f4eed8<br><br>Download would trigger here in the live platform.'); }
function getUtm(code) { const link=`https://housenest.ng/?utm_source=affiliate&utm_medium=referral&utm_campaign=${code}&ref=${code}`; navigator.clipboard?.writeText(link); showTextModal('UTM Tracking Link', `<code style="background:var(--mist);padding:0.3rem 0.6rem;border-radius:6px;font-size:0.8rem;word-break:break-all">${link}</code><br><br>This link includes UTM parameters so you can track in Google Analytics exactly which posts or messages are driving your referrals.<br><br>‚úÖ Copied to clipboard!`); }

function showTextModal(title, html) {
  document.getElementById('authTitle').textContent=title;
  document.getElementById('signupPanel').innerHTML=`<div style="font-size:0.85rem;color:var(--smoke);line-height:1.75">${html}</div><button class="btn btn-outline btn-sm" style="margin-top:1rem" onclick="closeModal('authModal')">Close</button>`;
  document.getElementById('loginPanel').classList.add('hidden');
  document.getElementById('mtab-signup').style.display='none';
  document.getElementById('mtab-login').style.display='none';
  openModal('authModal','signup');
}

// Profile save
function saveProfile() {
  const affiliates = DB.get('affiliates',[]);
  const idx = affiliates.findIndex(a=>a.id===currentUser.id);
  if(idx===-1){toast('err','Error saving');return;}
  affiliates[idx].firstName = document.getElementById('pf-first')?.value.trim()||affiliates[idx].firstName;
  affiliates[idx].lastName = document.getElementById('pf-last')?.value.trim()||affiliates[idx].lastName;
  affiliates[idx].email = document.getElementById('pf-email')?.value.trim()||affiliates[idx].email;
  affiliates[idx].phone = document.getElementById('pf-phone')?.value.trim()||affiliates[idx].phone;
  const newPass = document.getElementById('pf-pass')?.value;
  if(newPass&&newPass.length>=8) affiliates[idx].password=hashPass(newPass);
  DB.set('affiliates',affiliates);
  currentUser=affiliates[idx];
  DB.set('currentUser',currentUser);
  updateNavState();
  toast('ok','‚úÖ Profile updated!');
}

// Withdraw modal
function openWithdrawModal() {
  const u = currentUser;
  const available = (u.earnings||0)-(u.paid||0);
  const t = TIERS[u.role]||TIERS.user;
  document.getElementById('withdrawBody').innerHTML = `
  <div class="balance-display">
    <div class="bal-label">Available to Withdraw</div>
    <div class="bal-amount">‚Ç¶${available.toLocaleString()}</div>
    <div class="bal-pending">+‚Ç¶${(u.pending||0).toLocaleString()} pending clearance</div>
  </div>
  <div class="f-group"><label class="f-label">Bank</label>
    <select class="f-select" id="wd-bank"><option>Access Bank</option><option>GTBank</option><option>First Bank</option><option>UBA</option><option>Zenith Bank</option><option>Opay</option><option>Kuda</option></select></div>
  <div class="f-group"><label class="f-label">Account Number</label><input class="f-input" id="wd-acc" placeholder="0123456789" maxlength="10" style="font-family:'IBM Plex Mono',monospace"></div>
  <div class="f-group"><label class="f-label">Account Name</label><input class="f-input" id="wd-name" placeholder="As it appears on your bank"></div>
  <div class="f-group"><label class="f-label">Amount to Withdraw (‚Ç¶)</label><input class="f-input" id="wd-amount" type="number" value="${available}" max="${available}"><div class="f-hint">Min. ‚Ç¶${t.min.toLocaleString()} ¬∑ Max. ‚Ç¶${available.toLocaleString()}</div></div>
  <button class="btn btn-ok btn-full" style="margin-top:0.5rem" onclick="submitWithdraw(${available},${t.min})">Request Withdrawal ‚Üí</button>
  <p style="font-size:0.72rem;color:var(--smoke);text-align:center;margin-top:0.7rem">Processed via Paystack ¬∑ Arrives within 24hrs</p>`;
  openModal('withdrawModal');
}

function submitWithdraw(available, minWithdraw) {
  const amount = parseFloat(document.getElementById('wd-amount')?.value)||0;
  const acc = document.getElementById('wd-acc')?.value.trim();
  const name = document.getElementById('wd-name')?.value.trim();
  if(!acc||acc.length!==10){toast('err','Enter valid 10-digit account number');return;}
  if(!name){toast('err','Enter account name');return;}
  if(amount<minWithdraw){toast('err','Minimum withdrawal is ‚Ç¶'+minWithdraw.toLocaleString());return;}
  if(amount>available){toast('err','Amount exceeds available balance');return;}

  // Update user balance
  const affiliates=DB.get('affiliates',[]);
  const idx=affiliates.findIndex(a=>a.id===currentUser.id);
  if(idx!==-1){ affiliates[idx].paid=(affiliates[idx].paid||0)+amount; DB.set('affiliates',affiliates); currentUser=affiliates[idx]; DB.set('currentUser',currentUser); }
  closeModal('withdrawModal');
  toast('ok','üí∏ Withdrawal of ‚Ç¶'+amount.toLocaleString()+' submitted! Arriving within 24hrs.');
  renderDashboard();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ADMIN VIEW
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderAdmin() {
  const affiliates = DB.get('affiliates',[]);
  const commissions = DB.get('commissions',[]);
  const pending = affiliates.filter(a=>a.status==='pending');
  const active = affiliates.filter(a=>a.status==='active');
  const totalPaid = commissions.filter(c=>c.status==='paid').reduce((s,c)=>s+c.amount,0);

  document.getElementById('adminBody').innerHTML = `
  <div class="admin-stats">
    <div class="ast"><div class="ast-n">${affiliates.length}</div><div class="ast-l">Total Affiliates</div></div>
    <div class="ast"><div class="ast-n" style="color:var(--amber)">${pending.length}</div><div class="ast-l">Pending Approval</div></div>
    <div class="ast"><div class="ast-n" style="color:var(--ok)">${active.length}</div><div class="ast-l">Active Affiliates</div></div>
    <div class="ast"><div class="ast-n">‚Ç¶${totalPaid.toLocaleString()}</div><div class="ast-l">Total Commissions Paid</div></div>
  </div>

  <!-- Pending approvals -->
  ${pending.length>0?`
  <div class="dash-panel" style="margin-bottom:1.5rem">
    <div class="dash-panel-header"><div class="dph-title">‚è≥ Pending Approvals (${pending.length})</div></div>
    <div class="dash-panel-body">
      ${pending.map(a=>renderAffRow(a,true)).join('')}
    </div>
  </div>`:''}

  <!-- All affiliates -->
  <div class="dash-panel" style="margin-bottom:1.5rem">
    <div class="dash-panel-header">
      <div class="dph-title">All Affiliates</div>
      <div style="display:flex;gap:0.5rem">
        <select class="f-select" style="padding:0.3rem 0.6rem;font-size:0.78rem;border-radius:7px" onchange="filterAdminAff(this.value)">
          <option value="">All Tiers</option>
          <option value="corper">Corpers</option>
          <option value="influencer">Influencers</option>
          <option value="agent">Agents</option>
          <option value="user">Users</option>
        </select>
      </div>
    </div>
    <div class="dash-panel-body" id="adminAffList">
      ${affiliates.map(a=>renderAffRow(a,false)).join('')||'<p style="color:var(--smoke)">No affiliates yet.</p>'}
    </div>
  </div>

  <!-- Commission history -->
  <div class="dash-panel">
    <div class="dash-panel-header"><div class="dph-title">Recent Commissions</div></div>
    <div class="dash-panel-body">
      <table class="comm-table" style="width:100%">
        <thead><tr><th>Affiliate</th><th>Tier</th><th>Action</th><th>Amount</th><th>Status</th><th>Date</th><th></th></tr></thead>
        <tbody>
          ${[...commissions].reverse().map(c=>{
            const aff=affiliates.find(a=>a.id===c.affiliateId);
            const at=TIERS[aff?.role||'user'];
            return `<tr>
              <td style="font-weight:600">${aff?aff.firstName+' '+aff.lastName:'Unknown'}</td>
              <td><span class="aff-tier-tag ${at.tagClass}">${at.icon} ${at.label}</span></td>
              <td style="font-size:0.8rem">${c.action}</td>
              <td class="comm-amount">‚Ç¶${c.amount.toLocaleString()}</td>
              <td><span class="comm-${c.status}">${c.status.charAt(0).toUpperCase()+c.status.slice(1)}</span></td>
              <td style="color:var(--smoke);font-size:0.75rem">${timeAgo(c.date)}</td>
              <td>${c.status==='processing'?`<button class="approve-btn" onclick="markCommPaid('${c.id}')">Mark Paid</button>`:'‚Äî'}</td>
            </tr>`;}).join('')}
        </tbody>
      </table>
    </div>
  </div>`;
}

function renderAffRow(a, showActions) {
  const t = TIERS[a.role]||TIERS.user;
  return `<div class="aff-row">
    <div class="aff-av" style="background:${avatarColor(a.firstName)}">${a.firstName[0]}${a.lastName?a.lastName[0]:''}</div>
    <div>
      <div class="aff-name">${a.firstName} ${a.lastName} <span class="aff-tier-tag ${t.tagClass}">${t.icon} ${t.label}</span></div>
      <div class="aff-meta">${a.email} ¬∑ ${a.phone} ¬∑ <span class="aff-code">${a.code}</span> ¬∑ Joined ${timeAgo(a.joinDate)}</div>
      ${a.role==='influencer'&&a.platform?`<div style="font-size:0.7rem;color:var(--smoke);margin-top:0.2rem">üì± ${a.platform}: <a href="${a.profileUrl}" target="_blank" rel="noopener" style="color:var(--flame)">${a.profileUrl}</a></div>`:''}
      ${a.role==='corper'&&a.nysc?`<div style="font-size:0.7rem;color:var(--smoke);margin-top:0.2rem">üéì NYSC: ${a.nysc}</div>`:''}
    </div>
    <div class="aff-earnings">
      <div class="aff-earn-n">‚Ç¶${(a.earnings||0).toLocaleString()}</div>
      <div class="aff-earn-l">${a.conversions||0} conversions ¬∑ ${a.referrals||0} refs</div>
    </div>
    ${showActions?`<div style="display:flex;gap:0.4rem;flex-shrink:0;margin-left:0.5rem">
      <button class="approve-btn" onclick="approveAffiliate('${a.id}')">‚úì Approve</button>
      <button class="reject-btn" onclick="rejectAffiliate('${a.id}')">‚úï Reject</button>
    </div>`:`<span style="padding:0.2rem 0.6rem;border-radius:50px;font-size:0.65rem;font-weight:700;background:${a.status==='active'?'rgba(42,128,64,0.12)':'rgba(200,120,32,0.12)'};color:${a.status==='active'?'var(--ok)':'var(--amber)'};">${a.status}</span>`}
  </div>`;
}

function filterAdminAff(role) {
  const affiliates = DB.get('affiliates',[]);
  const filtered = role ? affiliates.filter(a=>a.role===role) : affiliates;
  document.getElementById('adminAffList').innerHTML = filtered.map(a=>renderAffRow(a,false)).join('')||'<p style="color:var(--smoke)">None found.</p>';
}

function approveAffiliate(id) {
  const affiliates=DB.get('affiliates',[]);
  const idx=affiliates.findIndex(a=>a.id===id);
  if(idx!==-1){ affiliates[idx].status='active'; DB.set('affiliates',affiliates); }
  toast('ok','‚úÖ Affiliate approved! SMS notification sent.');
  renderAdmin();
}
function rejectAffiliate(id) {
  const affiliates=DB.get('affiliates',[]);
  const idx=affiliates.findIndex(a=>a.id===id);
  if(idx!==-1){ affiliates[idx].status='rejected'; DB.set('affiliates',affiliates); }
  toast('err','Affiliate rejected. Notification sent.');
  renderAdmin();
}
function markCommPaid(id) {
  const comms=DB.get('commissions',[]);
  const idx=comms.findIndex(c=>c.id===id);
  if(idx!==-1){ comms[idx].status='paid'; DB.set('commissions',comms); }
  toast('ok','Commission marked as paid');
  renderAdmin();
}

// Platform copy helper
function renderPlatformCopy(u) {
  const platforms = [
    { name:'Twitter / X', icon:'ùïè', copy:`"Still searching for accommodation in [STATE]? üè° HouseNest connects you directly to verified landlords ‚Äî zero agent fees, legal agreement included, escrow payment protection. Use my code ${u.code}: housenest.ng/ref/${u.code} #HouseNest #Nigeria #NYSC"` },
    { name:'WhatsApp Status', icon:'üí¨', copy:`"Looking for a home? Use my HouseNest code ${u.code} to find verified listings across Ondo, Ekiti, Oyo, Osun & Kwara. Zero agent fees! housenest.ng/ref/${u.code}"` },
    { name:'Instagram Caption', icon:'üì∏', copy:`"New city, new home ‚ú® Whether you're a corper, student, or relocating for work ‚Äî HouseNest has verified listings with no agent fees and built-in legal protection. Link in bio! Code: ${u.code}"` },
    { name:'Facebook Group', icon:'üëç', copy:`"Hi everyone! I wanted to share something really useful for anyone looking for accommodation in Southwest Nigeria. HouseNest is a platform that connects you directly to verified landlords ‚Äî no agent, no commission, with legal tenancy agreements. Use referral code ${u.code} or visit housenest.ng/ref/${u.code}"` },
  ];
  return platforms.map(p=>`
  <div style="margin-bottom:1.2rem">
    <div style="font-weight:700;font-size:0.82rem;color:var(--forest);margin-bottom:0.4rem">${p.icon} ${p.name}</div>
    <div style="background:var(--mist);border-radius:10px;padding:0.9rem;font-size:0.8rem;color:var(--forest);line-height:1.65;position:relative">
      ${p.copy}
      <button class="code-copy-btn" style="position:absolute;top:0.6rem;right:0.6rem;background:var(--sand);color:var(--forest)" onclick="copyText('${p.copy.replace(/'/g,"\\'")}')">Copy</button>
    </div>
  </div>`).join('');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SOCIAL SHARING
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function shareToSocial(platform, code) {
  const link = getReferralLink(code);
  const text = `Find verified homes across Ondo, Ekiti, Oyo, Osun & Kwara with HouseNest ‚Äî zero agent fees, legal agreements, escrow protection. Use my code ${code}!`;
  const urls = {
    twitter: `https://twitter.com/intent/tweet?text=${encodeURIComponent(text+' '+link)}`,
    whatsapp: `https://wa.me/?text=${encodeURIComponent(text+' '+link)}`,
    facebook: `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(link)}&quote=${encodeURIComponent(text)}`,
    instagram: null,
  };
  if(platform==='instagram') { copyText(text+'\n'+link); toast('ok','üì∏ Caption copied! Open Instagram and paste in your post or Story.'); return; }
  if(urls[platform]) { window.open(urls[platform],'_blank','width=600,height=400'); }
}

function copyCode(code) { copyText(code); }
function copyLink(code) { copyText(getReferralLink(code)); toast('ok','üîó Referral link copied to clipboard!'); }
function copyText(t) { navigator.clipboard?.writeText(t).then(()=>toast('ok','üìã Copied!')).catch(()=>toast('warn','Copy: '+t)); }

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// MODAL & TOAST
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function openModal(id, tab) {
  document.getElementById(id)?.classList.add('open');
  document.body.style.overflow='hidden';
  if(id==='authModal') {
    // Reset modal tabs if shown as text modal
    document.getElementById('mtab-signup').style.display='';
    document.getElementById('mtab-login').style.display='';
    if(tab) switchAuthTab(tab);
  }
}
function closeModal(id) {
  document.getElementById(id)?.classList.remove('open');
  document.body.style.overflow='';
}
function toast(type='ok', msg='') {
  const icons={ok:'‚úÖ',warn:'‚ö†Ô∏è',err:'‚ùå'};
  const t=document.createElement('div');
  t.className='toast '+(type==='info'?'':type);
  t.innerHTML=`<span>${icons[type]||'‚ÑπÔ∏è'}</span>${msg}`;
  document.getElementById('toastC').appendChild(t);
  setTimeout(()=>{t.style.opacity='0';t.style.transform='translateX(16px)';t.style.transition='all 0.3s';setTimeout(()=>t.remove(),300);},3800);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// UTILITIES
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function timeAgo(ts) {
  const d=(Date.now()-ts)/1000;
  if(d<60) return 'just now';
  if(d<3600) return Math.floor(d/60)+'m ago';
  if(d<86400) return Math.floor(d/3600)+'h ago';
  return Math.floor(d/86400)+'d ago';
}
function avatarColor(name='') {
  const c=['#1a3a1e','#5c3020','#1e3a5c','#5c4a10','#3a1e5c','#1e4a5c','#5c2a20'];
  return c[(name.charCodeAt(0)||0)%c.length];
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// INIT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
document.addEventListener('DOMContentLoaded', () => {
  seedData();
  currentUser = DB.get('currentUser', null);
  updateNavState();
  renderHome();
  // Keyboard: close modals on Escape
  document.addEventListener('keydown', e=>{ if(e.key==='Escape'){ closeModal('authModal'); closeModal('withdrawModal'); } });
});
</script>
</body>
</html>
